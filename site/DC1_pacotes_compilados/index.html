
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../DC1_pacotes_binarios/">
      
      
        <link rel="next" href="../OpenSUSE_Linux/">
      
      
      <link rel="icon" href="../imagens/tux.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>DC-1 Pacotes Compilados - üêß Comunidade Officina's</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dc1-instalacao-por-pacotes-compilados" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="üêß Comunidade Officina&#39;s" class="md-header__button md-logo" aria-label="üêß Comunidade Officina's" data-md-component="logo">
      
  <img src="../imagens/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            üêß Comunidade Officina's
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DC-1 Pacotes Compilados
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Mudar para o modo escuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Mudar para o modo escuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Mudar para o modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Mudar para o modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  üìÇ 'In√≠cio'

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../Visao_Geral/" class="md-tabs__link">
        
  
  
    
  
  üìÇ 'Vis√£o Geral'

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../DHCP_Server/" class="md-tabs__link">
          
  
  
  üìÇ 'Servidores'

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../OpenSUSE_Linux/" class="md-tabs__link">
          
  
  
  üìÇ 'Distros Linux'

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../LPI_Aula_de_introducao/" class="md-tabs__link">
          
  
  
  üìÇ 'M√≥dulos LPI'

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Universo_NIX/" class="md-tabs__link">
          
  
  
  üìÇ 'Outros assuntos'

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="üêß Comunidade Officina&#39;s" class="md-nav__button md-logo" aria-label="üêß Comunidade Officina's" data-md-component="logo">
      
  <img src="../imagens/logo.png" alt="logo">

    </a>
    üêß Comunidade Officina's
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üìÇ 'In√≠cio'
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Visao_Geral/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    üìÇ 'Vis√£o Geral'
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üìÇ 'Servidores'
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üìÇ 'Servidores'
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DHCP_Server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DHCP Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DNS_Server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DNS Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Firewall_Server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Firewall Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Mkdocs_Server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MkDocs Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NFS_Server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NFS Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    File Servers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            File Servers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fileserver_Debian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fileserver Debian
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fileserver_Rocky/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fileserver Rocky
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fileserver_RockyLinux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fileserver Rocky (Alternativo)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fileserver_sem_RSAT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fileserver sem RSAT
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Controladores de Dom√≠nio
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Controladores de Dom√≠nio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DC1_Rocky/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DC-1 (Rocky)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DC2_Rocky/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DC-2 (Rocky)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DC1_pacotes_binarios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DC-1 Pacotes Bin√°rios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    DC-1 Pacotes Compilados
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    DC-1 Pacotes Compilados
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#controlador-de-dominio-primario-secundario-e-fileserver-no-debian-linux-13" class="md-nav__link">
    <span class="md-ellipsis">
      Controlador de Dom√≠nio Prim√°rio, Secund√°rio e Fileserver no Debian Linux 13
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layout-de-rede-usado-no-laboratorio" class="md-nav__link">
    <span class="md-ellipsis">
      Layout de rede usado no laborat√≥rio:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalando-as-dependencias-para-compilacao-do-codigo-fonte-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Instalando as depend√™ncias para compila√ß√£o do c√≥digo fonte do Samba4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setando-e-validando-o-hostname-do-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Setando e validando o hostname do dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configurando-o-arquivo-de-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      Configurando o arquivo de hosts:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setando-ip-fixo-no-servidor-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Setando ip fixo no servidor dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setando-endereco-do-firewall-como-resolvedor-externo-temporario-ate-provisionar-o-dominio" class="md-nav__link">
    <span class="md-ellipsis">
      Setando endere√ßo do firewall como resolvedor externo (tempor√°rio at√© provisionar o dom√≠nio):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-o-ip-da-placa" class="md-nav__link">
    <span class="md-ellipsis">
      Validando o ip da placa:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baixando-e-compilando-o-codigo-fonte-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Baixando e compilando o c√≥digo fonte do Samba4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-optsamba-ao-path-padrao-do-linux-colando-a-linha-completa-ao-final-do-bashrc" class="md-nav__link">
    <span class="md-ellipsis">
      Adicionando /opt/Samba ao path padr√£o do Linux, colando a linha completa ao final do .bashrc:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pathusrlocalsbinusrlocalbinusrsbinusrbinsbinbinoptsambabinoptsambasbin" class="md-nav__link">
    <span class="md-ellipsis">
      PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/samba/bin:/opt/samba/sbin"
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relendo-o-arquivo-de-profile" class="md-nav__link">
    <span class="md-ellipsis">
      Relendo o arquivo de profile:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-o-daemon-de-inicializacao-do-samba4-com-o-sistema" class="md-nav__link">
    <span class="md-ellipsis">
      Criando o daemon de inicializa√ß√£o do Samba4 com o sistema:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalando-e-editando-o-servico-de-sincronizacao-de-horario" class="md-nav__link">
    <span class="md-ellipsis">
      Instalando e editando o servi√ßo de sincroniza√ß√£o de hor√°rio:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provisionando-o-novo-dominio-suportado-pelo-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Provisionando o novo dom√≠nio suportado pelo dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#habilitando-o-daemon-pra-subir-no-boot-do-sistema" class="md-nav__link">
    <span class="md-ellipsis">
      Habilitando o daemon pra subir no boot do sistema:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linkando-o-arquivo-krb5conf-do-samba4-ao-etc-do-sistema" class="md-nav__link">
    <span class="md-ellipsis">
      Linkando o arquivo krb5.conf do Samba4 ao /etc do sistema:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apos-o-provisionamento-da-samba4-precisamos-reconfigurar-o-etcresolvconf-e-setar-o-dns-apontando-a-resolucao-de-nomes-para-o-proprio-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      AP√ìS o provisionamento da Samba4, precisamos reconfigurar o /etc/resolv.conf e setar o DNS apontando a resolu√ß√£o de nomes para o pr√≥prio dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bloqueando-alteracao-do-resolvconf" class="md-nav__link">
    <span class="md-ellipsis">
      Bloqueando altera√ß√£o do resolv.conf:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-resolvedor-de-nomes-pelo-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Validando resolvedor de nomes pelo dcmaster:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validando resolvedor de nomes pelo dcmaster:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vai-validar-na-tela" class="md-nav__link">
    <span class="md-ellipsis">
      Vai validar na tela:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reboot-do-servidor-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Reboot do servidor dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-os-servicos-do-samba4-no-boot-do-sistema" class="md-nav__link">
    <span class="md-ellipsis">
      Validando os servi√ßos do Samba4 no boot do sistema:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dando-poderes-de-root-ao-administrator" class="md-nav__link">
    <span class="md-ellipsis">
      Dando poderes de root ao Administrator:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linkando-bibliotecas-do-samba4-para-mapeamento-de-usuarios-no-sistema-linux-rode-esses-comandos-manualmente-sem-copiar-e-colar" class="md-nav__link">
    <span class="md-ellipsis">
      Linkando bibliotecas do Samba4 para mapeamento de usu√°rios no sistema Linux (rode esses comandos manualmente sem copiar e colar):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-a-autenticacao-de-usuarios-de-rede-no-sistema-linux-mas-tbem-no-winbind" class="md-nav__link">
    <span class="md-ellipsis">
      Validando a autentica√ß√£o de usu√°rios de rede no sistema Linux mas tb√©m no winbind:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#editando-o-arquivo-smbconf-e-adicionando-no-dns-forwarder-quem-resolve-nomes-para-consultas-externas-o-firewall-e-o-google" class="md-nav__link">
    <span class="md-ellipsis">
      Editando o arquivo smb.conf e adicionando no dns forwarder, quem resolve nomes para consultas externas (o firewall e o google):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relendo-a-configuracao-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Relendo a configura√ß√£o do Samba4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-usuarios-da-base-do-ldap-local" class="md-nav__link">
    <span class="md-ellipsis">
      Validando usu√°rios da base do ldap local:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-usuarios-de-rede-do-samba4-intermediados-pelo-winbind" class="md-nav__link">
    <span class="md-ellipsis">
      Validando usu√°rios de rede do Samba4 (Intermediados pelo winbind):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-daemons-ativos" class="md-nav__link">
    <span class="md-ellipsis">
      Validando daemons ativos:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consultando-servicos-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Consultando servi√ßos do SAMBA4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desabilitando-complexidade-de-senhas-inseguro" class="md-nav__link">
    <span class="md-ellipsis">
      Desabilitando complexidade de senhas (inseguro):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relendo-as-configuracoes-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Relendo as configura√ß√µes do SAMBA4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-a-troca-de-tickets-do-kerberos" class="md-nav__link">
    <span class="md-ellipsis">
      Validando a troca de tickets do Kerberos:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consultando-as-bases-do-kerberos-ldap-e-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Consultando as bases do kerberos, ldap e dns:
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìÇ 'Distros Linux'
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            üìÇ 'Distros Linux'
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OpenSUSE_Linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenSUSE Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Devuan_Linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Devuan Linux
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìÇ 'M√≥dulos LPI'
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            üìÇ 'M√≥dulos LPI'
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LPI_Aula_de_introducao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LPI Aula de Introdu√ß√£o
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    M√≥dulo LPIC-101
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            M√≥dulo LPIC-101
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LPIC-101.1_Identificacao_e_configuracao_de_hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    101.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LPIC-101.2_Processo_de_inicializacao_do_linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    101.2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LPIC-101.3_Runlevel_shutdown_e_reboot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    101.3
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    M√≥dulo LPIC-102
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            M√≥dulo LPIC-102
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LPIC-102.1_Particionamento_de_discos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    102.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LPIC-102.2_Gerenciamento_do_boot_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    102.2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    M√≥dulo LPIC-103
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            M√≥dulo LPIC-103
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LPIC-103.1_Shell_e_linha_de_comandos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    103.1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Modulo_103.1-aula02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aula 02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Modulo_103.1-aula03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aula 03
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Modulo_103.1-aula04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aula 04
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Modulo_103.1-aula05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aula 05
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    M√≥dulo 103.2 - Processamento de Texto
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            M√≥dulo 103.2 - Processamento de Texto
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Modulo_103.2-aula01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aula 01
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    üìÇ 'Outros assuntos'
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üìÇ 'Outros assuntos'
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Universo_NIX/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Universo *NIX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Aircrack-NG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aircrack-NG
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Systemd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    O SystemD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FHS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FHS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Raid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RAID
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Permissoes_Linux-01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Permiss√µes Linux 01
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Permissoes_Linux-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Permiss√µes Linux 02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Usuarios_e_Grupos-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usu√°rios e Grupos 01
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Usuarios_e_Grupos-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usu√°rios e Grupos 02
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#controlador-de-dominio-primario-secundario-e-fileserver-no-debian-linux-13" class="md-nav__link">
    <span class="md-ellipsis">
      Controlador de Dom√≠nio Prim√°rio, Secund√°rio e Fileserver no Debian Linux 13
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layout-de-rede-usado-no-laboratorio" class="md-nav__link">
    <span class="md-ellipsis">
      Layout de rede usado no laborat√≥rio:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalando-as-dependencias-para-compilacao-do-codigo-fonte-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Instalando as depend√™ncias para compila√ß√£o do c√≥digo fonte do Samba4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setando-e-validando-o-hostname-do-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Setando e validando o hostname do dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configurando-o-arquivo-de-hosts" class="md-nav__link">
    <span class="md-ellipsis">
      Configurando o arquivo de hosts:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setando-ip-fixo-no-servidor-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Setando ip fixo no servidor dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setando-endereco-do-firewall-como-resolvedor-externo-temporario-ate-provisionar-o-dominio" class="md-nav__link">
    <span class="md-ellipsis">
      Setando endere√ßo do firewall como resolvedor externo (tempor√°rio at√© provisionar o dom√≠nio):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-o-ip-da-placa" class="md-nav__link">
    <span class="md-ellipsis">
      Validando o ip da placa:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baixando-e-compilando-o-codigo-fonte-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Baixando e compilando o c√≥digo fonte do Samba4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adicionando-optsamba-ao-path-padrao-do-linux-colando-a-linha-completa-ao-final-do-bashrc" class="md-nav__link">
    <span class="md-ellipsis">
      Adicionando /opt/Samba ao path padr√£o do Linux, colando a linha completa ao final do .bashrc:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pathusrlocalsbinusrlocalbinusrsbinusrbinsbinbinoptsambabinoptsambasbin" class="md-nav__link">
    <span class="md-ellipsis">
      PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/samba/bin:/opt/samba/sbin"
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relendo-o-arquivo-de-profile" class="md-nav__link">
    <span class="md-ellipsis">
      Relendo o arquivo de profile:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#criando-o-daemon-de-inicializacao-do-samba4-com-o-sistema" class="md-nav__link">
    <span class="md-ellipsis">
      Criando o daemon de inicializa√ß√£o do Samba4 com o sistema:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalando-e-editando-o-servico-de-sincronizacao-de-horario" class="md-nav__link">
    <span class="md-ellipsis">
      Instalando e editando o servi√ßo de sincroniza√ß√£o de hor√°rio:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provisionando-o-novo-dominio-suportado-pelo-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Provisionando o novo dom√≠nio suportado pelo dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#habilitando-o-daemon-pra-subir-no-boot-do-sistema" class="md-nav__link">
    <span class="md-ellipsis">
      Habilitando o daemon pra subir no boot do sistema:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linkando-o-arquivo-krb5conf-do-samba4-ao-etc-do-sistema" class="md-nav__link">
    <span class="md-ellipsis">
      Linkando o arquivo krb5.conf do Samba4 ao /etc do sistema:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apos-o-provisionamento-da-samba4-precisamos-reconfigurar-o-etcresolvconf-e-setar-o-dns-apontando-a-resolucao-de-nomes-para-o-proprio-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      AP√ìS o provisionamento da Samba4, precisamos reconfigurar o /etc/resolv.conf e setar o DNS apontando a resolu√ß√£o de nomes para o pr√≥prio dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bloqueando-alteracao-do-resolvconf" class="md-nav__link">
    <span class="md-ellipsis">
      Bloqueando altera√ß√£o do resolv.conf:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-resolvedor-de-nomes-pelo-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Validando resolvedor de nomes pelo dcmaster:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validando resolvedor de nomes pelo dcmaster:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vai-validar-na-tela" class="md-nav__link">
    <span class="md-ellipsis">
      Vai validar na tela:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reboot-do-servidor-dcmaster" class="md-nav__link">
    <span class="md-ellipsis">
      Reboot do servidor dcmaster:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-os-servicos-do-samba4-no-boot-do-sistema" class="md-nav__link">
    <span class="md-ellipsis">
      Validando os servi√ßos do Samba4 no boot do sistema:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dando-poderes-de-root-ao-administrator" class="md-nav__link">
    <span class="md-ellipsis">
      Dando poderes de root ao Administrator:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linkando-bibliotecas-do-samba4-para-mapeamento-de-usuarios-no-sistema-linux-rode-esses-comandos-manualmente-sem-copiar-e-colar" class="md-nav__link">
    <span class="md-ellipsis">
      Linkando bibliotecas do Samba4 para mapeamento de usu√°rios no sistema Linux (rode esses comandos manualmente sem copiar e colar):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-a-autenticacao-de-usuarios-de-rede-no-sistema-linux-mas-tbem-no-winbind" class="md-nav__link">
    <span class="md-ellipsis">
      Validando a autentica√ß√£o de usu√°rios de rede no sistema Linux mas tb√©m no winbind:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#editando-o-arquivo-smbconf-e-adicionando-no-dns-forwarder-quem-resolve-nomes-para-consultas-externas-o-firewall-e-o-google" class="md-nav__link">
    <span class="md-ellipsis">
      Editando o arquivo smb.conf e adicionando no dns forwarder, quem resolve nomes para consultas externas (o firewall e o google):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relendo-a-configuracao-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Relendo a configura√ß√£o do Samba4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-usuarios-da-base-do-ldap-local" class="md-nav__link">
    <span class="md-ellipsis">
      Validando usu√°rios da base do ldap local:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-usuarios-de-rede-do-samba4-intermediados-pelo-winbind" class="md-nav__link">
    <span class="md-ellipsis">
      Validando usu√°rios de rede do Samba4 (Intermediados pelo winbind):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-daemons-ativos" class="md-nav__link">
    <span class="md-ellipsis">
      Validando daemons ativos:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consultando-servicos-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Consultando servi√ßos do SAMBA4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#desabilitando-complexidade-de-senhas-inseguro" class="md-nav__link">
    <span class="md-ellipsis">
      Desabilitando complexidade de senhas (inseguro):
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relendo-as-configuracoes-do-samba4" class="md-nav__link">
    <span class="md-ellipsis">
      Relendo as configura√ß√µes do SAMBA4:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validando-a-troca-de-tickets-do-kerberos" class="md-nav__link">
    <span class="md-ellipsis">
      Validando a troca de tickets do Kerberos:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consultando-as-bases-do-kerberos-ldap-e-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Consultando as bases do kerberos, ldap e dns:
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="dc1-instalacao-por-pacotes-compilados">üìÅ DC1 instala√ß√£o por pacotes compilados</h1>
<h2 id="controlador-de-dominio-primario-secundario-e-fileserver-no-debian-linux-13">Controlador de Dom√≠nio Prim√°rio, Secund√°rio e Fileserver no Debian Linux 13</h2>
<h2 id="layout-de-rede-usado-no-laboratorio">Layout de rede usado no laborat√≥rio:</h2>
<div class="highlight"><pre><span></span><code>firewall<span class="w">           </span><span class="m">192</span>.168.70.254<span class="w"> </span><span class="o">(</span>enp1s0<span class="o">)</span><span class="w"> </span>-<span class="w"> </span><span class="m">192</span>.168.122.254<span class="w"> </span><span class="o">(</span>enp7s0<span class="o">)</span><span class="w"> </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">2277</span><span class="o">)</span>
dcmaster<span class="w">           </span><span class="m">192</span>.168.70.250<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22250</span><span class="o">)</span>
mkdocs<span class="w">             </span><span class="m">192</span>.168.70.222<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22222</span><span class="o">)</span>
dcslave<span class="w">            </span><span class="m">192</span>.168.70.200<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22200</span><span class="o">)</span>
fileserver<span class="w">         </span><span class="m">192</span>.168.70.150<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22100</span><span class="o">)</span>

<span class="p">;</span><span class="w"> </span>firewall<span class="w">         </span>Roteamento<span class="w"> </span>por<span class="w"> </span>Iptables
<span class="p">;</span><span class="w"> </span>dcmaster<span class="w">         </span>Controlador<span class="w"> </span>de<span class="w"> </span>Dom√≠nio<span class="w"> </span>prim√°rio
<span class="p">;</span><span class="w"> </span>mkdocs<span class="w">           </span>Servidor<span class="w"> </span>de<span class="w"> </span>Documentos
<span class="p">;</span><span class="w"> </span>dcslave<span class="w">          </span>Controlador<span class="w"> </span>de<span class="w"> </span>Dom√≠nio<span class="w"> </span>secund√°rio
<span class="p">;</span><span class="w"> </span>fileserver<span class="w">       </span>Servidor<span class="w"> </span>de<span class="w"> </span>Arquivos
</code></pre></div>
<h2 id="instalando-as-dependencias-para-compilacao-do-codigo-fonte-do-samba4">Instalando as depend√™ncias para compila√ß√£o do c√≥digo fonte  do Samba4:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive<span class="p">;</span>apt-get<span class="w"> </span>update<span class="p">;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>vim<span class="w"> </span>net-tools<span class="w"> </span>rsync<span class="w"> </span>acl<span class="w"> </span>apt-utils<span class="w"> </span>attr<span class="w"> </span>autoconf<span class="w"> </span>bind9-utils<span class="w"> </span>binutils<span class="w"> </span>bison<span class="w"> </span>build-essential<span class="w"> </span>ccache<span class="w"> </span>chrpath<span class="w"> </span>curl<span class="w"> </span>debhelper<span class="w"> </span>bind9-dnsutils<span class="w"> </span>docbook-xml<span class="w"> </span>docbook-xsl<span class="w"> </span>flex<span class="w"> </span>gcc<span class="w"> </span>gdb<span class="w"> </span>git<span class="w"> </span>glusterfs-common<span class="w"> </span>gzip<span class="w"> </span>heimdal-multidev<span class="w"> </span>hostname<span class="w"> </span>htop<span class="w"> </span>krb5-config<span class="w"> </span>krb5-user<span class="w"> </span>lcov<span class="w"> </span>libacl1-dev<span class="w"> </span>libarchive-dev<span class="w"> </span>libattr1-dev<span class="w"> </span>libavahi-common-dev<span class="w"> </span>libblkid-dev<span class="w"> </span>libbsd-dev<span class="w"> </span>libcap-dev<span class="w"> </span>libcephfs-dev<span class="w"> </span>libcups2-dev<span class="w"> </span>libdbus-1-dev<span class="w"> </span>libglib2.0-dev<span class="w"> </span>libgnutls28-dev<span class="w"> </span>libgpgme-dev<span class="w"> </span>libicu-dev<span class="w"> </span>libjansson-dev<span class="w"> </span>libjs-jquery<span class="w"> </span>libjson-perl<span class="w"> </span>libkrb5-dev<span class="w"> </span>libldap2-dev<span class="w"> </span>liblmdb-dev<span class="w"> </span>libncurses-dev<span class="w"> </span>libpam0g-dev<span class="w"> </span>libparse-yapp-perl<span class="w"> </span>libpcap-dev<span class="w"> </span>libpopt-dev<span class="w"> </span>libreadline-dev<span class="w"> </span>libsystemd-dev<span class="w"> </span>libtasn1-bin<span class="w"> </span>libtasn1-6-dev<span class="w"> </span>libunwind-dev<span class="w"> </span>lmdb-utils<span class="w"> </span>locales<span class="w"> </span>lsb-release<span class="w"> </span>make<span class="w"> </span>mawk<span class="w"> </span>mingw-w64<span class="w"> </span>patch<span class="w"> </span>perl<span class="w"> </span>perl-modules-5.40<span class="w"> </span>pkg-config<span class="w"> </span>procps<span class="w"> </span>psmisc<span class="w"> </span>python3<span class="w"> </span>python3-cryptography<span class="w"> </span>python3-dbg<span class="w"> </span>python3-dev<span class="w"> </span>python3-dnspython<span class="w"> </span>python3-gpg<span class="w"> </span>python3-iso8601<span class="w"> </span>python3-markdown<span class="w"> </span>python3-matplotlib<span class="w"> </span>python3-pexpect<span class="w"> </span>python3-pyasn1<span class="w"> </span>rsync<span class="w"> </span>sed<span class="w">  </span>tar<span class="w"> </span>tree<span class="w"> </span>uuid-dev<span class="w"> </span>wget<span class="w"> </span>xfslibs-dev<span class="w"> </span>xsltproc<span class="w"> </span>zlib1g-dev<span class="w"> </span>-y
</code></pre></div>
<h2 id="setando-e-validando-o-hostname-do-dcmaster">Setando e validando o hostname do dcmaster:</h2>
<div class="highlight"><pre><span></span><code>hostnamectl<span class="w"> </span>set-hostname<span class="w"> </span>dcmaster
</code></pre></div>
<h2 id="configurando-o-arquivo-de-hosts">Configurando o arquivo de hosts:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/hosts
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="m">127</span>.0.0.1<span class="w">          </span>localhost
<span class="m">127</span>.0.1.1<span class="w">          </span>dcmaster.officinas.edu<span class="w">    </span>dcmaster
<span class="m">192</span>.168.70.254<span class="w">     </span>dcmaster.officinas.edu<span class="w">    </span>dcmaster
</code></pre></div>
<div class="highlight"><pre><span></span><code>hostname<span class="w"> </span>-f
</code></pre></div>
<h2 id="setando-ip-fixo-no-servidor-dcmaster">Setando ip fixo no servidor dcmaster:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/network/interfaces
</code></pre></div>
<div class="highlight"><pre><span></span><code>iface<span class="w"> </span>enp1s0<span class="w"> </span>inet<span class="w"> </span>static
address<span class="w">           </span><span class="m">192</span>.168.70.250
netmask<span class="w">           </span><span class="m">255</span>.255.255.0
gateway<span class="w">           </span><span class="m">192</span>.168.70.254
</code></pre></div>
<h2 id="setando-endereco-do-firewall-como-resolvedor-externo-temporario-ate-provisionar-o-dominio">Setando endere√ßo do firewall como resolvedor externo (tempor√°rio at√© provisionar o dom√≠nio):</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>nameserver<span class="w">         </span><span class="m">192</span>.168.70.254<span class="w"> </span><span class="c1">#(firewall)</span>
</code></pre></div>
<h2 id="validando-o-ip-da-placa">Validando o ip da placa:</h2>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>-c<span class="w"> </span>addr
</code></pre></div>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>-br<span class="w"> </span>link
</code></pre></div>
<h2 id="baixando-e-compilando-o-codigo-fonte-do-samba4">Baixando e compilando o c√≥digo fonte do Samba4:</h2>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://download.samba.org/pub/samba/samba-4.23.2.tar.gz
</code></pre></div>
<div class="highlight"><pre><span></span><code>tar<span class="w"> </span>-xvzf<span class="w"> </span>samba-4.23.2.tar.gz
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>samba-4.23.2
</code></pre></div>
<div class="highlight"><pre><span></span><code>./configure<span class="w"> </span>--prefix<span class="o">=</span>/opt/samba
</code></pre></div>
<div class="highlight"><pre><span></span><code>make
</code></pre></div>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span>install
</code></pre></div>
<h2 id="adicionando-optsamba-ao-path-padrao-do-linux-colando-a-linha-completa-ao-final-do-bashrc">Adicionando /opt/Samba ao path padr√£o do Linux, colando a linha completa ao final do .bashrc:</h2>
<h2 id="pathusrlocalsbinusrlocalbinusrsbinusrbinsbinbinoptsambabinoptsambasbin">PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/samba/bin:/opt/samba/sbin"</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>~/.bashrc
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/samba/bin:/opt/samba/sbin&quot;</span>
</code></pre></div>
<h2 id="relendo-o-arquivo-de-profile">Relendo o arquivo de profile:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>~/.bashrc
</code></pre></div>
<h2 id="criando-o-daemon-de-inicializacao-do-samba4-com-o-sistema">Criando o daemon de inicializa√ß√£o do Samba4 com o sistema:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/systemd/system/samba-ad-dc.service
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>Unit<span class="o">]</span>
<span class="w">   </span><span class="nv">Description</span><span class="o">=</span>Samba4<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>Master<span class="w"> </span>Domain<span class="w"> </span>Controller
<span class="w">   </span><span class="nv">After</span><span class="o">=</span>network.target<span class="w"> </span>remote-fs.target<span class="w"> </span>nss-lookup.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="w">   </span><span class="nv">Type</span><span class="o">=</span>forking
<span class="w">   </span><span class="nv">ExecStart</span><span class="o">=</span>/opt/samba/sbin/samba<span class="w"> </span>-D
<span class="w">   </span><span class="nv">PIDFile</span><span class="o">=</span>/opt/samba/var/run/samba.pid

<span class="o">[</span>Install<span class="o">]</span>
<span class="w">   </span><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>/etc/systemd/system/samba-ad-dc.service
</code></pre></div>
<h2 id="instalando-e-editando-o-servico-de-sincronizacao-de-horario">Instalando e editando o servi√ßo de sincroniza√ß√£o de hor√°rio:</h2>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>/etc/ntpsec/ntp.conf<span class="o">{</span>,.orig<span class="o">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/ntpsec/ntp.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>driftfile<span class="w"> </span>/var/lib/ntpsec/ntp.drift
leapfile<span class="w"> </span>/usr/share/zoneinfo/leap-seconds.list
pool<span class="w"> </span>a.ntp.org<span class="w"> </span>iburst
pool<span class="w"> </span>b.ntp.org<span class="w"> </span>iburst
pool<span class="w"> </span><span class="m">2</span>.debian.pool.ntp.org<span class="w"> </span>iburst
pool<span class="w"> </span><span class="m">3</span>.debian.pool.ntp.org<span class="w"> </span>iburst
restrict<span class="w"> </span><span class="m">127</span>.0.0.1
restrict<span class="w"> </span>::1
tinker<span class="w"> </span>panic<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1">#(Flag usada SOMENTE em VMs)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>ntpd
</code></pre></div>
<div class="highlight"><pre><span></span><code>ntpq<span class="w"> </span>-p
</code></pre></div>
<h2 id="provisionando-o-novo-dominio-suportado-pelo-dcmaster">Provisionando o novo dom√≠nio suportado pelo dcmaster:</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>domain<span class="w"> </span>provision<span class="w"> </span>--use-rfc2307<span class="w"> </span>--interactive<span class="w"> </span>--option<span class="o">=</span>‚Äùinterfaces<span class="o">=</span>lo<span class="w"> </span>enp1s0‚Äù<span class="w"> </span>--option<span class="o">=</span>‚Äùbind<span class="w"> </span>interfaces<span class="w"> </span><span class="nv">only</span><span class="o">=</span>yes‚Äù
</code></pre></div>
<h2 id="habilitando-o-daemon-pra-subir-no-boot-do-sistema">Habilitando o daemon pra subir no boot do sistema:</h2>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>daemon-reload
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>samba-ad-dc.service
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>samba-ad-dc.service
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>samba-ad-dc.service
</code></pre></div>
<h2 id="linkando-o-arquivo-krb5conf-do-samba4-ao-etc-do-sistema">Linkando o arquivo krb5.conf do Samba4 ao /etc do sistema:</h2>
<div class="highlight"><pre><span></span><code>mv<span class="w"> </span>/etc/krb5.conf<span class="o">{</span>,.orig<span class="o">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ln<span class="w"> </span>-sf<span class="w"> </span>/opt/samba/private/krb5.conf<span class="w"> </span>/etc/krb5.conf
</code></pre></div>
<h2 id="apos-o-provisionamento-da-samba4-precisamos-reconfigurar-o-etcresolvconf-e-setar-o-dns-apontando-a-resolucao-de-nomes-para-o-proprio-dcmaster">AP√ìS o provisionamento da Samba4, precisamos reconfigurar o /etc/resolv.conf e setar o DNS apontando a resolu√ß√£o de nomes para o pr√≥prio dcmaster:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>domain<span class="w">           </span>officinas.edu
search<span class="w">           </span>officinas.edu.
nameserver<span class="w">       </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="c1">#(localhost)</span>
</code></pre></div>
<h2 id="bloqueando-alteracao-do-resolvconf">Bloqueando altera√ß√£o do resolv.conf:</h2>
<div class="highlight"><pre><span></span><code>chattr<span class="w"> </span>+i<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<h2 id="validando-resolvedor-de-nomes-pelo-dcmaster">Validando resolvedor de nomes pelo dcmaster:</h2>
<div class="highlight"><pre><span></span><code>nslookup<span class="w"> </span>dcmaster.officinas.edu
</code></pre></div>
<h3 id="vai-validar-na-tela">Vai validar na tela:</h3>
<div class="highlight"><pre><span></span><code>Server:<span class="w">         </span><span class="m">127</span>.0.0.1
Address:<span class="w">        </span><span class="m">127</span>.0.0.1#53

Name:<span class="w">   </span>dcmaster.officinas.edu
Address:<span class="w"> </span><span class="m">192</span>.168.70.250
</code></pre></div>
<h2 id="reboot-do-servidor-dcmaster">Reboot do servidor dcmaster:</h2>
<div class="highlight"><pre><span></span><code>reboot
</code></pre></div>
<h2 id="validando-os-servicos-do-samba4-no-boot-do-sistema">Validando os servi√ßos do Samba4 no boot do sistema:</h2>
<div class="highlight"><pre><span></span><code>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>samba
</code></pre></div>
<div class="highlight"><pre><span></span><code>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s2">&quot;samba|smbd|nmbd|winbind&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>find<span class="w"> </span>/<span class="w"> </span>-name<span class="w"> </span>samba.pid
</code></pre></div>
<div class="highlight"><pre><span></span><code>pgrep<span class="w"> </span>samba
</code></pre></div>
<h2 id="dando-poderes-de-root-ao-administrator">Dando poderes de root ao Administrator:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/opt/samba/etc/user.map
</code></pre></div>
<div class="highlight"><pre><span></span><code>!root<span class="o">=</span>officinas.edu<span class="se">\A</span>dministrator
</code></pre></div>
<h2 id="linkando-bibliotecas-do-samba4-para-mapeamento-de-usuarios-no-sistema-linux-rode-esses-comandos-manualmente-sem-copiar-e-colar">Linkando bibliotecas do Samba4 para mapeamento de usu√°rios no sistema Linux (rode esses comandos manualmente sem copiar e colar):</h2>
<div class="highlight"><pre><span></span><code>/opt/samba/sbin/smbd<span class="w"> </span>-b<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>LIBDIR
</code></pre></div>
<div class="highlight"><pre><span></span><code>ln<span class="w"> </span>-s<span class="w"> </span>/opt/samba/lib/libnss_winbind.so.2<span class="w"> </span>/lib/x86-64-linux-gnu
</code></pre></div>
<div class="highlight"><pre><span></span><code>ln<span class="w"> </span>-s<span class="w"> </span>/lib/x86_64-linux-gnu/libnss_winbind.so.2<span class="w"> </span>/lib/x86_64-linux-gnu/libnss_winbind.so
</code></pre></div>
<div class="highlight"><pre><span></span><code>ldconfig
</code></pre></div>
<h2 id="validando-a-autenticacao-de-usuarios-de-rede-no-sistema-linux-mas-tbem-no-winbind">Validando a autentica√ß√£o de usu√°rios de rede no sistema Linux mas tb√©m no winbind:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/nsswitch.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>passwd:<span class="w"> </span>files<span class="w"> </span>systemd<span class="w"> </span>winbind
group:<span class="w"> </span>files<span class="w"> </span>systemd<span class="w"> </span>winbind
shadow:<span class="w"> </span>files
</code></pre></div>
<h2 id="editando-o-arquivo-smbconf-e-adicionando-no-dns-forwarder-quem-resolve-nomes-para-consultas-externas-o-firewall-e-o-google">Editando o arquivo smb.conf e adicionando no dns forwarder, quem resolve nomes para consultas externas (o firewall e o google):</h2>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>/opt/samba/etc/smb.conf<span class="o">{</span>,.orig<span class="o">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/opt/samba/etc/smb.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>global<span class="o">]</span>
<span class="w">      </span><span class="nb">bind</span><span class="w"> </span>interfaces<span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Yes
<span class="w">      </span>dns<span class="w"> </span><span class="nv">forwarder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">192</span>.168.70.254<span class="w"> </span><span class="m">8</span>.8.8.8<span class="w"> </span><span class="c1">#(firewall + google)</span>
<span class="w">      </span><span class="nv">interfaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lo<span class="w"> </span>enp1s0
<span class="w">      </span>netbios<span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DCMASTER
<span class="w">      </span><span class="nv">realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OFFICINAS.EDU
<span class="w">      </span>server<span class="w"> </span><span class="nv">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>active<span class="w"> </span>directory<span class="w"> </span>domain<span class="w"> </span>controller
<span class="w">      </span><span class="nv">workgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OFFICINAS
<span class="w">      </span>idmap_ldb:use<span class="w"> </span><span class="nv">rfc2307</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes

<span class="o">[</span>sysvol<span class="o">]</span>
<span class="w">      </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/opt/samba/var/locks/sysvol
<span class="w">      </span><span class="nb">read</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>No

<span class="o">[</span>netlogon<span class="o">]</span>
<span class="w">      </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/opt/samba/var/locks/sysvol/officinas.edu/scripts
<span class="w">      </span><span class="nb">read</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>No
</code></pre></div>
<h2 id="relendo-a-configuracao-do-samba4">Relendo a configura√ß√£o do Samba4:</h2>
<div class="highlight"><pre><span></span><code>smbcontrol<span class="w"> </span>all<span class="w"> </span>reload-config
</code></pre></div>
<h2 id="validando-usuarios-da-base-do-ldap-local">Validando usu√°rios da base do ldap local:</h2>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/etc/passwd<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>root
</code></pre></div>
<h2 id="validando-usuarios-de-rede-do-samba4-intermediados-pelo-winbind">Validando usu√°rios de rede do Samba4 (Intermediados pelo winbind):</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>user<span class="w"> </span>show<span class="w"> </span>administrator
</code></pre></div>
<div class="highlight"><pre><span></span><code>getent<span class="w"> </span>passwd<span class="w"> </span>administrator
</code></pre></div>
<div class="highlight"><pre><span></span><code>wbinfo<span class="w"> </span>-u
</code></pre></div>
<div class="highlight"><pre><span></span><code>wbinfo<span class="w"> </span>-g
</code></pre></div>
<div class="highlight"><pre><span></span><code>wbinfo<span class="w"> </span>--ping-dc
</code></pre></div>
<div class="highlight"><pre><span></span><code>getent<span class="w"> </span>group<span class="w"> </span><span class="s2">&quot;Domain Admins&quot;</span>
</code></pre></div>
<h2 id="validando-daemons-ativos">Validando daemons ativos:</h2>
<div class="highlight"><pre><span></span><code>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s2">&quot;samba|smbd|nmbd|winbind&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ps<span class="w"> </span>axf
</code></pre></div>
<h2 id="consultando-servicos-do-samba4">Consultando servi√ßos do SAMBA4:</h2>
<div class="highlight"><pre><span></span><code>smbclient<span class="w"> </span>--version
</code></pre></div>
<div class="highlight"><pre><span></span><code>smbclient<span class="w"> </span>-L<span class="w"> </span>dc01<span class="w"> </span>-U<span class="w"> </span>Administrator
</code></pre></div>
<div class="highlight"><pre><span></span><code>smbclient<span class="w"> </span>//localhost/netlogon<span class="w"> </span>-UAdministrator<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;ls&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>testparm
</code></pre></div>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>domain<span class="w"> </span>level<span class="w"> </span>show
</code></pre></div>
<h2 id="desabilitando-complexidade-de-senhas-inseguro">Desabilitando complexidade de senhas (inseguro):</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>domain<span class="w"> </span>passwordsettings<span class="w"> </span>show
</code></pre></div>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>domain<span class="w"> </span>passwordsettings<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--complexity<span class="o">=</span>off
</code></pre></div>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>domain<span class="w"> </span>passwordsettings<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--history-length<span class="o">=</span><span class="m">0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>domain<span class="w"> </span>passwordsettings<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--min-pwd-length<span class="o">=</span><span class="m">0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>domain<span class="w"> </span>passwordsettings<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--min-pwd-age<span class="o">=</span><span class="m">0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>user<span class="w"> </span>setexpiry<span class="w"> </span>Administrator<span class="w"> </span>--noexpiry
</code></pre></div>
<h2 id="relendo-as-configuracoes-do-samba4">Relendo as configura√ß√µes do SAMBA4:</h2>
<div class="highlight"><pre><span></span><code>smbcontrol<span class="w"> </span>all<span class="w"> </span>reload-config
</code></pre></div>
<h2 id="validando-a-troca-de-tickets-do-kerberos">Validando a troca de tickets do Kerberos:</h2>
<div class="highlight"><pre><span></span><code><span class="w"> </span>kinit<span class="w"> </span>Administrator@OFFICINAS.EDU
</code></pre></div>
<div class="highlight"><pre><span></span><code>klist<span class="w">¬†</span>
</code></pre></div>
<h2 id="consultando-as-bases-do-kerberos-ldap-e-dns">Consultando as bases do kerberos, ldap e dns:</h2>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-t<span class="w"> </span>srv<span class="w"> </span>_kerberos._tcp.officinas.edu
</code></pre></div>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-t<span class="w"> </span>srv<span class="w"> </span>_ldap._tcp.officinas.edu
</code></pre></div>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-t<span class="w"> </span>A<span class="w"> </span>dcmaster.officinas.edu.
</code></pre></div>
<div class="highlight"><pre><span></span><code>dig<span class="w"> </span>officinas.edu
</code></pre></div>
<p>THAT‚ÄôS ALL FOLKS!!</p>
<h1 id="controlador-de-dominio-secundario-com-samba4-no-debian-linux-13">Controlador de Dom√≠nio secund√°rio com Samba4 no Debian Linux 13</h1>
<h2 id="layout-de-rede-usado-no-laboratorio_1">Layout de rede usado no laborat√≥rio:</h2>
<div class="highlight"><pre><span></span><code>firewall<span class="w">           </span><span class="m">192</span>.168.70.254<span class="w"> </span><span class="o">(</span>enp1s0<span class="o">)</span><span class="w"> </span>-<span class="w"> </span><span class="m">192</span>.168.122.254<span class="w"> </span><span class="o">(</span>enp7s0<span class="o">)</span><span class="w"> </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">2277</span><span class="o">)</span>
dcmaster<span class="w">           </span><span class="m">192</span>.168.70.250<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22250</span><span class="o">)</span>
mkdocs<span class="w">             </span><span class="m">192</span>.168.70.222<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22222</span><span class="o">)</span>
dcslave<span class="w">            </span><span class="m">192</span>.168.70.200<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22200</span><span class="o">)</span>
fileserver<span class="w">         </span><span class="m">192</span>.168.70.150<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22100</span><span class="o">)</span>

<span class="p">;</span><span class="w"> </span>firewall<span class="w">         </span>Roteamento<span class="w"> </span>por<span class="w"> </span>Iptables
<span class="p">;</span><span class="w"> </span>dcmaster<span class="w">         </span>Controlador<span class="w"> </span>de<span class="w"> </span>Dom√≠nio<span class="w"> </span>prim√°rio
<span class="p">;</span><span class="w"> </span>mkdocs<span class="w">           </span>Servidor<span class="w"> </span>de<span class="w"> </span>Documentos
<span class="p">;</span><span class="w"> </span>dcslave<span class="w">          </span>Controlador<span class="w"> </span>de<span class="w"> </span>Dom√≠nio<span class="w"> </span>secund√°rio
<span class="p">;</span><span class="w"> </span>fileserver<span class="w">       </span>Servidor<span class="w"> </span>de<span class="w"> </span>Arquivos
</code></pre></div>
<h2 id="instalando-as-dependencias-para-compilacao-do-codigo-fonte-do-samba4_1">Instalando as depend√™ncias para compila√ß√£o do c√≥digo fonte do Samba4:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive<span class="p">;</span>apt-get<span class="w"> </span>update<span class="p">;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>vim<span class="w"> </span>net-tools<span class="w"> </span>rsync<span class="w"> </span>acl<span class="w"> </span>apt-utils<span class="w"> </span>attr<span class="w"> </span>autoconf<span class="w"> </span>bind9-utils<span class="w"> </span>binutils<span class="w"> </span>bison<span class="w"> </span>build-essential<span class="w"> </span>ntp<span class="w"> </span>rsync<span class="w"> </span>ccache<span class="w"> </span>chrpath<span class="w"> </span>curl<span class="w"> </span>debhelper<span class="w"> </span>bind9-dnsutils<span class="w"> </span>docbook-xml<span class="w"> </span>docbook-xsl<span class="w"> </span>flex<span class="w"> </span>gcc<span class="w"> </span>gdb<span class="w"> </span>git<span class="w"> </span>glusterfs-common<span class="w"> </span>gzip<span class="w"> </span>heimdal-multidev<span class="w"> </span>hostname<span class="w"> </span>htop<span class="w"> </span>krb5-config<span class="w"> </span>krb5-user<span class="w"> </span>lcov<span class="w"> </span>libacl1-dev<span class="w"> </span>libarchive-dev<span class="w"> </span>libattr1-dev<span class="w"> </span>libavahi-common-dev<span class="w"> </span>libblkid-dev<span class="w"> </span>libbsd-dev<span class="w"> </span>libcap-dev<span class="w"> </span>libcephfs-dev<span class="w"> </span>libcups2-dev<span class="w"> </span>libdbus-1-dev<span class="w"> </span>libglib2.0-dev<span class="w"> </span>libgnutls28-dev<span class="w"> </span>libgpgme-dev<span class="w"> </span>libicu-dev<span class="w"> </span>libjansson-dev<span class="w"> </span>libjs-jquery<span class="w"> </span>libjson-perl<span class="w"> </span>libkrb5-dev<span class="w"> </span>libldap2-dev<span class="w"> </span>liblmdb-dev<span class="w"> </span>libncurses-dev<span class="w"> </span>libpam0g-dev<span class="w"> </span>libparse-yapp-perl<span class="w"> </span>libpcap-dev<span class="w"> </span>libpopt-dev<span class="w"> </span>libreadline-dev<span class="w"> </span>libsystemd-dev<span class="w"> </span>libtasn1-bin<span class="w"> </span>libtasn1--5-dev<span class="w"> </span>libunwind-dev<span class="w"> </span>lmdb-utils<span class="w"> </span>locales<span class="w"> </span>lsb-release<span class="w"> </span>make<span class="w"> </span>mawk<span class="w"> </span>mingw-w64<span class="w"> </span>patch<span class="w"> </span>perl<span class="w"> </span>perl-modules-5.40<span class="w"> </span>pkg-config<span class="w"> </span>procps<span class="w"> </span>psmisc<span class="w"> </span>python3<span class="w"> </span>python3-cryptography<span class="w"> </span>python3-dbg<span class="w"> </span>python3-dev<span class="w"> </span>python3-dnspython<span class="w"> </span>python3-gpg<span class="w"> </span>python3-iso8601<span class="w"> </span>python3-markdown<span class="w"> </span>python3-matplotlib<span class="w"> </span>python3-pexpect<span class="w"> </span>python3-pyasn1<span class="w"> </span>rsync<span class="w"> </span>sed<span class="w"> </span>tar<span class="w"> </span>tree<span class="w"> </span>uuid-dev<span class="w"> </span>wget<span class="w"> </span>xfslibs-dev<span class="w"> </span>xsltproc<span class="w"> </span>zlib1g-dev<span class="w"> </span>-y
</code></pre></div>
<h2 id="setando-e-validando-o-hostname-do-dcslave">Setando e validando o hostname do dcslave:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/hostname
</code></pre></div>
<div class="highlight"><pre><span></span><code>dcslave
</code></pre></div>
<div class="highlight"><pre><span></span><code>hostname<span class="w"> </span>-f
</code></pre></div>
<div class="highlight"><pre><span></span><code>dcslave.officinas.edu
</code></pre></div>
<h2 id="configurando-o-arquivo-de-hosts_1">Configurando o arquivo de hosts:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/hosts
</code></pre></div>
<div class="highlight"><pre><span></span><code>.0.0.1<span class="w">              </span>localhost
<span class="m">127</span>.0.1.1<span class="w">           </span>dcslave.officinas.edu<span class="w">       </span>dcslave
<span class="m">192</span>.168.70.150<span class="w">      </span>fileserver.officinas.edu<span class="w">    </span>fileserver
<span class="m">192</span>.168.70.200<span class="w">      </span>dcslave.officinas.edu<span class="w">       </span>dcslave
<span class="m">192</span>.168.70.222<span class="w">      </span>mkdocs.officinas.edu<span class="w">        </span>mkdocs
<span class="m">192</span>.168.70.250<span class="w">      </span>dcmaster.officinas.edu<span class="w">      </span>dcmaster
<span class="m">192</span>.168.70.254<span class="w">      </span>firewall.officinas.edu<span class="w">      </span>firewall
</code></pre></div>
<h2 id="setando-ip-fixo-no-servidor-dcslave">Setando ip fixo no servidor dcslave:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/network/interfaces
</code></pre></div>
<div class="highlight"><pre><span></span><code>allow-hotplug<span class="w"> </span>enp1s0
iface<span class="w"> </span>enp1s0<span class="w"> </span>inet<span class="w"> </span>static
address<span class="w">           </span><span class="m">192</span>.168.70.200
netmask<span class="w">           </span><span class="m">255</span>.255.255.0
gateway<span class="w">           </span><span class="m">192</span>.168.70.254
</code></pre></div>
<h2 id="apontando-o-endereco-do-resolvedor-de-nomes-principal-da-rede-pro-controlador-de-dominio-primario-dcmaster-temporario-ate-provisionar">Apontando o endere√ßo do resolvedor de nomes principal da rede pro Controlador de dom√≠nio prim√°rio, dcmaster (tempor√°rio, at√© provisionar):</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>domain<span class="w">           </span>officinas.edu
search<span class="w">           </span>officinas.edu.
nameserver<span class="w">       </span><span class="m">192</span>.168.70.250<span class="w"> </span><span class="c1">#(dcmaster)</span>
nameserver<span class="w">       </span><span class="m">127</span>.0.0.1
</code></pre></div>
<h2 id="validando-a-resolucao-de-nomes-pelo-dcmaster">Validando a resolu√ß√£o de nomes pelo dcmaster:</h2>
<div class="highlight"><pre><span></span><code>nslookup<span class="w"> </span>officinas.edu
</code></pre></div>
<div class="highlight"><pre><span></span><code>Server:<span class="w">         </span><span class="m">192</span>.168.70.250
Address:<span class="w">        </span><span class="m">192</span>.168.70.250#53

Name:<span class="w">   </span>officinas.edu
Address:<span class="w"> </span><span class="m">192</span>.168.70.250
Name:<span class="w">   </span>officinas.edu
Address:<span class="w"> </span><span class="m">192</span>.168.70.200
</code></pre></div>
<h2 id="relendo-as-configuracoes-de-rede">Relendo as configura√ß√µes de rede:</h2>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>networking
</code></pre></div>
<h2 id="validando-o-ip-da-placa_1">Validando o ip da placa:</h2>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>-c<span class="w"> </span>addr
</code></pre></div>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>-br<span class="w"> </span>link
</code></pre></div>
<h2 id="baixando-e-compilando-o-codigo-fonte-do-samba4_1">Baixando e compilando o c√≥digo fonte do Samba4:</h2>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://download.samba.org/pub/samba/samba-4.19.4.tar.gz
</code></pre></div>
<div class="highlight"><pre><span></span><code>tar<span class="w"> </span>-xvzf<span class="w"> </span>samba-4.19.4.tar.gz
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>samba-4.19.4
</code></pre></div>
<div class="highlight"><pre><span></span><code>./configure<span class="w"> </span>--prefix<span class="o">=</span>/opt/samba
</code></pre></div>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install
</code></pre></div>
<h2 id="adicionando-optsamba-ao-path-padrao-do-linux-colando-a-linha-completa-ao-final-do-bashrc_1">Adicionando /opt/Samba ao path padr√£o do Linux, colando a linha completa ao final do .bashrc:</h2>
<h2 id="pathusrlocalsbinusrlocalbinusrsbinusrbinsbinbinoptsambabinoptsambasbin_1">PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/samba/bin:/opt/samba/sbin"</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>~/.bashrc
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/samba/bin:/opt/samba/sbin&quot;</span>
</code></pre></div>
<h2 id="relendo-o-arquivo-de-profile_1">Relendo o arquivo de profile:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>~/.bashrc
</code></pre></div>
<h2 id="criando-o-daemon-de-inicializacao-do-samba4-com-o-sistema_1">Criando o daemon de inicializa√ß√£o do Samba4 com o sistema:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/systemd/system/samba-ad-dc.service
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>Unit<span class="o">]</span>
<span class="w">   </span><span class="nv">Description</span><span class="o">=</span>Samba4<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>Slave<span class="w"> </span>Domain<span class="w"> </span>Controller
<span class="w">   </span><span class="nv">After</span><span class="o">=</span>network.target<span class="w"> </span>remote-fs.target<span class="w"> </span>nss-lookup.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="w">   </span><span class="nv">Type</span><span class="o">=</span>forking
<span class="w">   </span><span class="nv">ExecStart</span><span class="o">=</span>/opt/samba/sbin/samba<span class="w"> </span>-D
<span class="w">   </span><span class="nv">PIDFile</span><span class="o">=</span>/opt/samba/var/run/samba.pid

<span class="o">[</span>Install<span class="o">]</span>
<span class="w">   </span><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>/etc/systemd/system/samba-ad-dc.service
</code></pre></div>
<h2 id="configurando-o-servico-de-sincronizacao-de-horario-apontando-pro-controlador-de-dominio-primario-dcmaster">Configurando o servi√ßo de sincroniza√ß√£o de hor√°rio, apontando pro Controlador de dom√≠nio prim√°rio, dcmaster:</h2>
<div class="highlight"><pre><span></span><code>mv<span class="w"> </span>/etc/ntpsec/ntp.conf<span class="o">{</span>,.orig<span class="o">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/ntpsec/ntp.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>driftfile<span class="w"> </span>/var/lib/ntpsec/ntp.drift
leapfile<span class="w"> </span>/usr/share/zoneinfo/leap-seconds.list
tos<span class="w"> </span>minclock<span class="w"> </span><span class="m">4</span><span class="w"> </span>minsane<span class="w"> </span><span class="m">3</span>
pool<span class="w"> </span><span class="m">192</span>.168.70.250<span class="w"> </span>iburst<span class="w"> </span><span class="c1">#(dcmaster)</span>
restrict<span class="w"> </span>default<span class="w"> </span>kod<span class="w"> </span>nomodify<span class="w"> </span>nopeer<span class="w"> </span>noquery<span class="w"> </span>limited
restrict<span class="w"> </span><span class="m">127</span>.0.0.1
restrict<span class="w"> </span>::1
tinker<span class="w"> </span>panic<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1">#(Flag usada SOMENTE em VMs)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>ntp
</code></pre></div>
<div class="highlight"><pre><span></span><code>ntpq<span class="w"> </span>-p
</code></pre></div>
<div class="highlight"><pre><span></span><code>date
</code></pre></div>
<p>As m√°quinas Windows/Linux, membros do dom√≠nio, usar√£o o DC1 que ret√©m a fun√ß√£o FSMO emulador PDC como fonte de tempo padr√£o!</p>
<h2 id="provisionando-o-servidor-dcslave">Provisionando o servidor DCSLAVE:</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>domain<span class="w"> </span>join<span class="w"> </span>OFFICINAS.EDU<span class="w"> </span>DC<span class="w"> </span>-U<span class="w"> </span>Administrator<span class="w"> </span>--realm<span class="o">=</span>OFFICINAS.EDU<span class="w"> </span>--dns-backend<span class="o">=</span>SAMBA_INTERNAL<span class="w"> </span>--option<span class="o">=</span><span class="s2">&quot;interfaces=lo enp1s0&quot;</span><span class="w"> </span>--option<span class="o">=</span><span class="s2">&quot;bind interfaces only=yes&quot;</span><span class="w"> </span>--option<span class="o">=</span><span class="s2">&quot;idmap_ldb:use-rfc2307=yes&quot;</span>
</code></pre></div>
<h2 id="habilitando-o-daemon-pra-subir-no-boot-do-sistema_1">Habilitando o daemon pra subir no boot do sistema:</h2>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>daemon<span class="w"> </span>reload
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>samba-ad-dc.service
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>samba-ad-dc.service
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>samba-ad-dc.service
</code></pre></div>
<h2 id="editando-o-arquivo-do-kerberos">Editando o arquivo do kerberos:</h2>
<div class="highlight"><pre><span></span><code>mv<span class="w"> </span>/etc/krb5.conf<span class="o">{</span>,.orig<span class="o">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/krb5.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>libdefaults<span class="o">]</span><span class="w"> </span><span class="c1">#(sem espa√ßo no canto dessa linha)</span>
<span class="w">    </span><span class="nv">dns_lookup_realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="nv">dns_lookup_kdc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="nv">default_realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OFFICINAS.EDU
</code></pre></div>
<h2 id="visualizando-o-arquivo-smbconf">Visualizando o arquivo smb.conf:</h2>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/opt/samba/etc/smb.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Global parameters</span>
<span class="o">[</span>global<span class="o">]</span>
<span class="w">    </span><span class="nb">bind</span><span class="w"> </span>interfaces<span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Yes
<span class="w">    </span><span class="nv">interfaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lo<span class="w"> </span>enp1s0
<span class="w">    </span>netbios<span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DCSLAVE
<span class="w">    </span><span class="nv">realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OFFICINAS.EDU
<span class="w">    </span>server<span class="w"> </span><span class="nv">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>active<span class="w"> </span>directory<span class="w"> </span>domain<span class="w"> </span>controller
<span class="w">    </span><span class="nv">workgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OFFICINAS
<span class="w">    </span>idmap_ldb:use-rfc2307<span class="w"> </span><span class="o">=</span><span class="w"> </span>yes

<span class="o">[</span>sysvol<span class="o">]</span>
<span class="w">    </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/opt/samba/var/locks/sysvol
<span class="w">    </span><span class="nb">read</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>No

<span class="o">[</span>netlogon<span class="o">]</span>
<span class="w">    </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/opt/samba/var/locks/sysvol/officinas.edu/scripts
<span class="w">    </span><span class="nb">read</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>No
</code></pre></div>
<h2 id="validando-as-entradas-dns-usadas">Validando as entradas DNS usadas:</h2>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>install<span class="w"> </span>ldb-tools
</code></pre></div>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-t<span class="w"> </span>A<span class="w"> </span>officinas.edu.
</code></pre></div>
<h2 id="se-necessario-se-necessario-adicione-as-entradas-do-dcslave-manualmente-ao-dns-do-samba4-no-dcmaster">(SE NECESS√ÅRIO), SE Necess√°rio, adicione as entradas do dcslave, manualmente AO DNS do Samba4, no dcmaster:</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>dns<span class="w"> </span>add<span class="w"> </span>dcmaster<span class="w"> </span>OFFICINAS.EDU<span class="w"> </span>dcslave<span class="w"> </span>A<span class="w"> </span><span class="m">192</span>.168.70.200<span class="w"> </span>-U<span class="w"> </span>administrator
</code></pre></div>
<div class="highlight"><pre><span></span><code>ldbsearch<span class="w"> </span>-H<span class="w"> </span>/opt/samba/private/sam.ldb<span class="w"> </span><span class="s1">&#39;(invocationId=*)&#39;</span><span class="w"> </span>--cross-ncs<span class="w"> </span>objectguid
</code></pre></div>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-t<span class="w"> </span>CNAME<span class="w"> </span>df4bdd8c-abc7-4779-b01e-4dd4553ca3e9._msdcs.officinas.edu.
</code></pre></div>
<h2 id="se-nao-rodar-execute-a-replicacao-para-todos-os-dcs">SE n√£o rodar, execute a replica√ß√£o para todos os DCs:</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>dns<span class="w"> </span>add<span class="w"> </span>dcmaster<span class="w"> </span>_msdcs.officinas.edu<span class="w"> </span>df4bdd8c-abc7-4779-b01e-4dd4553ca3e9<span class="w"> </span>CNAME<span class="w"> </span>dcslave.officinas.edu<span class="w"> </span>-Uadministrator
</code></pre></div>
<h2 id="pasta-sysvol">PASTA SYSVOL</h2>
<h2 id="replicando-a-pasta-sysvol-mapeando-ids-de-grupos-e-usuarios-para-o-dcslave-execute-estes-comando-no-dcmaster">Replicando a pasta sysvol. Mapeando IDs de grupos e usu√°rios para o dcslave (execute estes comando NO DCMASTER):</h2>
<div class="highlight"><pre><span></span><code>tdbbackup<span class="w"> </span>-s<span class="w"> </span>.bak<span class="w"> </span>/opt/samba/private/idmap.ldb
</code></pre></div>
<div class="highlight"><pre><span></span><code>scp<span class="w"> </span>-rv<span class="w"> </span>-p22200<span class="w"> </span>/opt/samba/private/idmap.ldb.bak<span class="w"> </span>root@dcslave:/root
</code></pre></div>
<div class="highlight"><pre><span></span><code>scp<span class="w"> </span>-rv<span class="w"> </span>-p22200<span class="w"> </span>/opt/samba/var/locks/sysvol/*<span class="w"> </span>root@dcslave:/opt/samba/var/locks/sysvol
</code></pre></div>
<h2 id="aplicando-o-arquivo-bd-que-enviamos-do-dcmaster-execute-estes-comandos-no-dcslave">Aplicando o arquivo BD que enviamos do dcmaster (execute estes comandos NO DCSLAVE):</h2>
<div class="highlight"><pre><span></span><code>mv<span class="w"> </span>/root/idmap.ldb.bak<span class="w"> </span>/root/idmap.ldb
</code></pre></div>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>-rfv<span class="w"> </span>/root/idmap.ldb<span class="w"> </span>/opt/samba/private/
</code></pre></div>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>ntacl<span class="w"> </span>sysvolreset
</code></pre></div>
<h2 id="agora-precisamos-pensar-que-tendo-dois-dcs-na-rede-se-cair-o-primario-o-secundario-assume-o-controle-e-vice-versa-logicamente-devemos-apontar-um-pro-outro-como-resolvedor-de-nomes-primario-ou-seja-o-dcmaster-vai-resolver-primeiro-no-dcslave-e-o-dcslave-vai-resolver-primeiro-no-dcmaster">Agora precisamos pensar que tendo dois DCs na rede, SE cair o prim√°rio o secund√°rio assume o controle, e vice versa. Logicamente devemos apontar um pro outro como resolvedor de nomes prim√°rio, ou seja, o dcmaster vai resolver primeiro no dcslave e o dcslave vai resolver primeiro no dcmaster:</h2>
<h2 id="edite-o-etcresolvconf-no-dcmaster-e-aponte-pro-dcslave">Edite o /etc/resolv.conf NO DCMASTER e aponte pro dcslave:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>domain<span class="w">           </span>officinas.edu
search<span class="w">           </span>officinas.edu.
nameserver<span class="w">       </span><span class="m">192</span>.168.70.200<span class="w"> </span><span class="c1">#(dcslave)</span>
nameserver<span class="w">       </span><span class="m">127</span>.0.0.1
</code></pre></div>
<h2 id="bloqueando-a-edicao-do-arquivo-resolvconf">Bloqueando a edi√ß√£o do arquivo resolv.conf:</h2>
<div class="highlight"><pre><span></span><code>chattr<span class="w"> </span>+i<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<h2 id="e-no-reverso-edite-o-etcresolvconf-no-dcslave-apontando-pro-dcmaster">E no reverso, edite o /etc/resolv.conf NO DCSLAVE apontando pro dcmaster:</h2>
<h2 id="desbloqueando-a-edicao-do-arquivo-resolvconf">Desbloqueando a edi√ß√£o do arquivo resolv.conf:</h2>
<div class="highlight"><pre><span></span><code>chattr<span class="w"> </span>-i<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>domain<span class="w">           </span>officinas.edu
search<span class="w">           </span>officinas.edu.
nameserver<span class="w">       </span><span class="m">192</span>.168.70.250<span class="w"> </span><span class="c1">#(dcmaster)</span>
nameserver<span class="w">       </span><span class="m">127</span>.0.0.1
</code></pre></div>
<h2 id="bloqueando-a-edicao-do-arquivo-resolvconf_1">Bloqueando a edi√ß√£o do arquivo resolv.conf:</h2>
<div class="highlight"><pre><span></span><code>chattr<span class="w"> </span>+i<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<h2 id="validando-a-replicacao-execute-em-todos-os-dcs">Validando a replica√ß√£o ( execute em todos os DCs):</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>drs<span class="w"> </span>showrepl
</code></pre></div>
<h2 id="criando-um-usuario-no-dcmaster-execute-no-dcmaster">Criando um usu√°rio no dcmaster (execute NO DCMASTER):</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>userteste
</code></pre></div>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>user<span class="w"> </span>list
</code></pre></div>
<h2 id="validando-no-dcslave-se-consta-o-usuario-criado-no-dcmaster-execute-no-dcslave">Validando no dcslave, se consta o usu√°rio criado no dcmaster (execute NO DCSLAVE):</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>user<span class="w"> </span>list
</code></pre></div>
<h2 id="validando-o-compartilhamento-padrao">Validando o compartilhamento padr√£o:</h2>
<div class="highlight"><pre><span></span><code>smbclient<span class="w"> </span>-L<span class="w"> </span>localhost<span class="w"> </span>-U%
</code></pre></div>
<div class="highlight"><pre><span></span><code>smbclient<span class="w"> </span>//localhost/netlogon<span class="w"> </span>-UAdministrator<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;ls&#39;</span>
</code></pre></div>
<h2 id="validando-o-dns-local">Validando o DNS local:</h2>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-t<span class="w"> </span>A<span class="w"> </span>officinas.edu<span class="w"> </span>localhost
</code></pre></div>
<h2 id="validando-a-troca-de-tickets-do-kerberos_1">Validando a troca de tickets do kerberos:</h2>
<div class="highlight"><pre><span></span><code>kinit<span class="w"> </span>Administrator
</code></pre></div>
<div class="highlight"><pre><span></span><code>klist
</code></pre></div>
<h2 id="validando-configuracao-de-kerberos-e-ldap">Validando configura√ß√£o de kerberos e ldap:</h2>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-t<span class="w"> </span>srv<span class="w"> </span>_kerberos._tcp.officinas.edu
</code></pre></div>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-t<span class="w"> </span>srv<span class="w"> </span>_ldap._tcp.officinas.edu
</code></pre></div>
<div class="highlight"><pre><span></span><code>dig<span class="w"> </span>officinas.edu
</code></pre></div>
<div class="highlight"><pre><span></span><code>host<span class="w"> </span>-t<span class="w"> </span>A<span class="w"> </span>&lt;m√°quina<span class="w"> </span><span class="k">do</span><span class="w"> </span>dom√≠nio&gt;
</code></pre></div>
<h2 id="validando-informacoes-de-servidor-qual-controla-o-pdc-emulator">Validando informa√ß√µes de servidor qual controla o PDC Emulator:</h2>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>fsmo<span class="w"> </span>show<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>pdc
</code></pre></div>
<div class="highlight"><pre><span></span><code>samba-tool<span class="w"> </span>fsmo<span class="w"> </span>show
</code></pre></div>
<h2 id="validando-a-localizacao-do-diretorio-sysvol-do-dcmaster">Validando a localiza√ß√£o do diret√≥rio 'sysvol' do dcmaster:</h2>
<div class="highlight"><pre><span></span><code>uname<span class="w"> </span>-ra
</code></pre></div>
<div class="highlight"><pre><span></span><code>find<span class="w"> </span>/opt/samba<span class="w"> </span>-iname<span class="w"> </span>sysvol
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">     </span>/opt/samba/var/locks/sysvol
</code></pre></div>
<h2 id="validando-espaco-disponivel">Validando espa√ßo dispon√≠vel:</h2>
<div class="highlight"><pre><span></span><code>df<span class="w"> </span>-h
</code></pre></div>
<h2 id="validando-a-uuid-do-seu-disco">Validando a UUID do seu disco:</h2>
<div class="highlight"><pre><span></span><code>blkid<span class="w"> </span>/dev/sda2<span class="w"> </span><span class="c1">#(Sete A SUA parti√ß√£o de disco)</span>
</code></pre></div>
<h2 id="validando-suporte-ativo-no-kernel-as-flags-de-acl-e-seguranca">Validando suporte ativo no Kernel √°s flags de acl e seguran√ßa:</h2>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/boot/config-6.1.0-17-amd64<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>_ACL
</code></pre></div>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/boot/config-6.1.0-17-amd64<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>FS_SECURITY
</code></pre></div>
<h2 id="gerando-e-enviando-as-chaves-do-ssh-para-sincronizacao-entre-o-dcmaster-e-o-dcslave-crie-as-chaves-no-dcmaster-e-envie-a-chave-publica-para-o-dcslave">Gerando e enviando as chaves do ssh para sincroniza√ß√£o entre o dcmaster e o dcslave (crie as chaves NO DCMASTER e envie a chave p√∫blica para o dcslave):</h2>
<h2 id="pode-deixar-a-senha-em-branco-se-preferir">(Pode deixar a senha em branco SE preferir)</h2>
<div class="highlight"><pre><span></span><code>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-b<span class="w"> </span><span class="m">1024</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ssh-copy-id<span class="w"> </span>-p22200<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_rsa.pub<span class="w"> </span>root@dcslave<span class="w"> </span><span class="c1">#(O MEU dcslave usa a porta ssh 22200)</span>
</code></pre></div>
<h2 id="testando-a-conexao-por-ssh-sem-pedir-senha-se-vc-deixou-em-branco">Testando a conex√£o por ssh sem pedir senha (SE vc deixou em branco):</h2>
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-p22200<span class="w"> </span>dcslave
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">exit</span>
</code></pre></div>
<h2 id="agora-inverta-a-ordem-e-crie-as-chaves-no-dcslave-e-envie-para-o-dcmaster-rode-estes-comandos-no-dcslave">Agora inverta a ordem e crie as chaves NO DCSLAVE e envie para o dcmaster (Rode estes comandos NO DCSLAVE):</h2>
<div class="highlight"><pre><span></span><code>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-b<span class="w"> </span><span class="m">1024</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ssh-copy-id<span class="w"> </span>-p22250<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_rsa.pub<span class="w"> </span>root@dcmaster<span class="w"> </span><span class="c1">#(enviando para o dcmaster, que usa porta ssh 22250)</span>
</code></pre></div>
<h2 id="testando-a-conexao-por-ssh-sem-pedir-senha-se-vc-deixou-em-branco_1">Testando a conex√£o por ssh sem pedir senha (SE vc deixou em branco):</h2>
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-p22250<span class="w"> </span>dcmaster
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">exit</span>
</code></pre></div>
<h2 id="criando-script-de-sincronizacao-com-rsync-do-diretorio-sysvol-do-dcmaster-para-envio-ao-dcslave-rode-estes-comando-no-dcmaster">Criando script de sincroniza√ß√£o com rsync do diret√≥rio 'sysvol' DO DCMASTER para envio ao dcslave (rode estes comando NO DCMASTER):</h2>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>rsync-sysvol.sh
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># Sincronizando Diretorios do Sysvol do dcmaster para envio ao dcslave:</span>
<span class="c1">#rsync -Cravz /opt/samba/var/locks/sysvol/*  root@192.168.70.200:/opt/samba/var/locks/sysvol/</span>
<span class="c1"># no MEU CASO onde a porta do ssh n√£o √° a default. MEU dcslave usa 22200:</span>
rsync<span class="w"> </span>-Cravz<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;ssh -p 22200&quot;</span><span class="w"> </span>/opt/samba/var/locks/sysvol/*<span class="w">  </span>root@192.168.70.200:/opt/samba/var/locks/sysvol/
</code></pre></div>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>rsync-sysvol
</code></pre></div>
<div class="highlight"><pre><span></span><code>./rsync-sysvol
</code></pre></div>
<h2 id="agendando-a-sincronizacao-no-cron-do-dcmaster">Agendando a sincroniza√ß√£o no cron do dcmaster:</h2>
<div class="highlight"><pre><span></span><code>crontab<span class="w"> </span>-e
</code></pre></div>
<div class="highlight"><pre><span></span><code>*/5<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>root<span class="w">  </span>bash<span class="w"> </span>/opt/rsync-sysvol.sh<span class="w"> </span>--silent
</code></pre></div>
<h2 id="repita-o-processo-de-replicacao-do-sysvol-agora-no-dcslave-invertendo-os-apontamentos-de-ip-obviamente">REPITA o processo de replica√ß√£o do sysvol, agora NO DCSLAVE, INVERTENDO os apontamentos de ip, obviamente!</h2>
<h2 id="criando-script-de-sincronizacao-do-diretorio-sysvol-do-dcslave-para-envio-ao-dcmaster-rode-os-comando-agora-no-dcslave">Criando script de sincroniza√ß√£o do diret√≥rio 'sysvol' DO DCSLAVE para envio ao dcmaster (rode os comando agora NO DCSLAVE):</h2>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>rsync-sysvol.sh
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># Sincronizando Diretorios do Sysvol do dcmaster para envio ao dcslave:</span>
<span class="c1">#rsync -Cravz /opt/samba/var/locks/sysvol/*  root@192.168.70.250:/opt/samba/var/locks/sysvol/</span>
<span class="c1"># no MEU CASO onde a porta do ssh n√£o √° a default. MEU dcmaster usa 22250:</span>
rsync<span class="w"> </span>-Cravz<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;ssh -p 22250&quot;</span><span class="w"> </span>/opt/samba/var/locks/sysvol/*<span class="w">  </span>root@192.168.70.250:/opt/samba/var/locks/sysvol/
</code></pre></div>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>rsync-sysvol
</code></pre></div>
<div class="highlight"><pre><span></span><code>./rsync-sysvol
</code></pre></div>
<h2 id="agendando-a-sincronizacao-no-cron-do-dcslave">Agendando a sincroniza√ß√£o no cron do dcslave:</h2>
<div class="highlight"><pre><span></span><code>crontab<span class="w"> </span>-e
</code></pre></div>
<div class="highlight"><pre><span></span><code>*/5<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>root<span class="w">  </span>bash<span class="w"> </span>/opt/rsync-sysvol.sh<span class="w"> </span>--silent
</code></pre></div>
<h2 id="as-estacoes-de-trabalho-usarao-como-dns-primario-o-pdc-emulator-do-dominio-e-como-dns-secundario-o-pdc-secundario-da-rede">As Esta√ß√µes de trabalho, usar√£o, como DNS prim√°rio o PDC Emulator do Dom√≠nio, e como DNS secund√°rio o PDC Secund√°rio da rede.</h2>
<h2 id="osync">OSYNC</h2>
<h2 id="configurando-a-sincronizacao-da-pasta-sysvol-com-osync-que-vai-espelhar-os-dcs-rode-esses-comandos-no-dcmaster-primeiro">Configurando a sincroniza√ß√£o da pasta sysvol com osync, que vai espelhar os DCs (rode esses comandos NO DCMASTER, primeiro):</h2>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt
</code></pre></div>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/deajan/osync.git
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>osync
</code></pre></div>
<div class="highlight"><pre><span></span><code>sh<span class="w"> </span>./install.sh
</code></pre></div>
<h2 id="vai-criar-o-diretorio-etcosync">Vai criar o diret√≥rio /etc/osync:</h2>
<h2 id="dentro-dele-vai-ter-o-arquivo-de-configuracao-syncconfexample-crie-um-arquivo-syncconf-e-cole-o-conteudo-abaixo">Dentro dele vai ter o arquivo de configura√ß√£o sync.conf.example. Crie um arquivo sync.conf e cole o conte√∫do abaixo:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/osync/sync.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">INSTANCE_ID</span><span class="o">=</span><span class="s2">&quot;sysvol_sync&quot;</span>

<span class="nv">INITIATOR_SYNC_DIR</span><span class="o">=</span><span class="s2">&quot;/opt/samba/var/locks/sysvol&quot;</span>

<span class="nv">TARGET_SYNC_DIR</span><span class="o">=</span><span class="s2">&quot;ssh://root@192.168.70.200:22200//opt/samba/var/locks/sysvol&quot;</span>

<span class="nv">SSH_RSA_PRIVATE_KEY</span><span class="o">=</span><span class="s2">&quot;/root/.ssh/id_rsa&quot;</span>

<span class="nv">REMOTE_3RD_PARTY_HOSTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">PRESERVE_ACL</span><span class="o">=</span>yes

<span class="nv">PRESERVE_XATTR</span><span class="o">=</span>yes

<span class="nv">SOFT_DELETE</span><span class="o">=</span>yes

<span class="nv">DESTINATION_MAILS</span><span class="o">=</span><span class="s2">&quot;roor@localhost&quot;</span>

<span class="c1">#REMOTE_RUN_AFTER_CMD=&quot;/opt/samba/bin/samba-tool ntacl sysvolreset&quot;</span>
</code></pre></div>
<h2 id="rodando-o-script-de-atualizacao-que-esta-dentro-do-optosync-apontando-pro-arquivo-etcosyncsyncconf">rodando o script de atualiza√ß√£o, que est√° dentro do /opt/osync, apontando pro arquivo /etc/osync/sync.conf:</h2>
<div class="highlight"><pre><span></span><code>./upgrade-v1.0x-v1.2x.sh<span class="w"> </span>/etc/osync/sync.conf
</code></pre></div>
<h2 id="vai-ficar-semelhante-ao-modelo-abaixo">Vai ficar semelhante ao modelo abaixo:</h2>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">INSTANCE_ID</span><span class="o">=</span><span class="s2">&quot;sysvol_sync&quot;</span>

<span class="nv">INITIATOR_SYNC_DIR</span><span class="o">=</span><span class="s2">&quot;/opt/samba/var/locks/sysvol&quot;</span>

<span class="nv">TARGET_SYNC_DIR</span><span class="o">=</span><span class="s2">&quot;ssh://root@192.168.70.200:22200//opt/samba/var/locks/sysvol&quot;</span>

<span class="nv">SSH_RSA_PRIVATE_KEY</span><span class="o">=</span><span class="s2">&quot;/root/.ssh/id_rsa&quot;</span>

<span class="nv">SSH_PASSWORD_FILE</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">_REMOTE_TOKEN</span><span class="o">=</span><span class="s2">&quot;SomeAlphaNumericToken9&quot;</span>

<span class="nv">CREATE_DIRS</span><span class="o">=</span><span class="nb">false</span>

<span class="nv">LOGFILE</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">MINIMUM_SPACE</span><span class="o">=</span><span class="s2">&quot;10240&quot;</span>

<span class="nv">BANDWIDTH</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>

<span class="nv">SUDO_EXEC</span><span class="o">=</span><span class="nb">false</span>

<span class="nv">RSYNC_EXECUTABLE</span><span class="o">=</span><span class="s2">&quot;rsync&quot;</span>

<span class="nv">RSYNC_REMOTE_PATH</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">RSYNC_PATTERN_FIRST</span><span class="o">=</span><span class="s2">&quot;include&quot;</span>

<span class="nv">RSYNC_INCLUDE_PATTERN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">RSYNC_EXCLUDE_PATTERN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">RSYNC_INCLUDE_FROM</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">RSYNC_EXCLUDE_FROM</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">PATH_SEPARATOR_CHAR</span><span class="o">=</span><span class="s2">&quot;;&quot;</span>

<span class="nv">SSH_COMPRESSION</span><span class="o">=</span><span class="nb">true</span>

<span class="nv">SSH_IGNORE_KNOWN_HOSTS</span><span class="o">=</span><span class="nb">false</span>

<span class="nv">SSH_CONTROLMASTER</span><span class="o">=</span><span class="nb">false</span>

<span class="nv">REMOTE_HOST_PING</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div>
<h2 id="testando-o-sincronizmo-ignore-o-erro-de-email">Testando o sincronizmo (ignore o erro de email):</h2>
<div class="highlight"><pre><span></span><code>/usr/local/bin/osync.sh<span class="w"> </span>/etc/osync/sync.conf<span class="w"> </span>--dry<span class="w"> </span>--verbose
</code></pre></div>
<h2 id="rodar-o-sincronizmo-de-fato">Rodar o sincronizmo de fato:</h2>
<div class="highlight"><pre><span></span><code>/usr/local/bin/osync.sh<span class="w"> </span>/etc/osync/sync.conf<span class="w"> </span>--verbose
</code></pre></div>
<h2 id="agendar-no-cron">Agendar no cron:</h2>
<div class="highlight"><pre><span></span><code>crontab<span class="w"> </span>-e
</code></pre></div>
<div class="highlight"><pre><span></span><code>*/5<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>root<span class="w">  </span>bash<span class="w"> </span>/usr/local/bin/osync.sh<span class="w"> </span>/etc/osync/sync.conf<span class="w"> </span>--silent
</code></pre></div>
<h2 id="validando-os-logs-em-tempo-real-rode-o-usrlocalbinosyncsh-mantendo-outro-terminal-aberto-com-o-comando">Validando os logs em tempo real, rode o /usr/local/bin/osync.sh, mantendo outro terminal aberto com o comando:</h2>
<div class="highlight"><pre><span></span><code>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/osync.sysvol_sync.log
</code></pre></div>
<h2 id="invertendo-a-sincronizacao-com-o-osync-vamos-refazer-tudo-incluindo-o-ip-e-porta-ssh-agora-no-dcslave">INVERTENDO a sincroniza√ß√£o com o Osync, vamos refazer tudo, inclu√≠ndo o ip e porta ssh, agora NO DCSLAVE:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt
</code></pre></div>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/deajan/osync.git
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>osync
</code></pre></div>
<div class="highlight"><pre><span></span><code>sh<span class="w"> </span>./install.sh
</code></pre></div>
<h2 id="vai-criar-o-diretorio-etcosync_1">Vai criar o diret√≥rio /etc/osync:</h2>
<h2 id="dentro-dele-vai-ter-o-arquivo-de-configuracao-syncconfexample-crie-um-arquivo-syncconf-e-cole-o-conteudo-abaixo_1">Dentro dele vai ter o arquivo de configura√ß√£o sync.conf.example. Crie um arquivo sync.conf e cole o conte√∫do abaixo:</h2>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">INSTANCE_ID</span><span class="o">=</span><span class="s2">&quot;sysvol_sync&quot;</span>

<span class="nv">INITIATOR_SYNC_DIR</span><span class="o">=</span><span class="s2">&quot;/opt/samba/var/locks/sysvol&quot;</span>

<span class="nv">TARGET_SYNC_DIR</span><span class="o">=</span><span class="s2">&quot;ssh://root@192.168.70.250:22250//opt/samba/var/locks/sysvol&quot;</span>

<span class="nv">SSH_RSA_PRIVATE_KEY</span><span class="o">=</span><span class="s2">&quot;/root/.ssh/id_rsa&quot;</span>

<span class="nv">REMOTE_3RD_PARTY_HOSTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">PRESERVE_ACL</span><span class="o">=</span>yes

<span class="nv">PRESERVE_XATTR</span><span class="o">=</span>yes

<span class="nv">SOFT_DELETE</span><span class="o">=</span>yes

<span class="nv">DESTINATION_MAILS</span><span class="o">=</span><span class="s2">&quot;roor@localhost&quot;</span>

<span class="c1">#REMOTE_RUN_AFTER_CMD=&quot;/opt/samba/bin/samba-tool ntacl sysvolreset&quot;</span>
</code></pre></div>
<h2 id="vai-precisa-configurar-seu-ip-e-o-path-pra-rodar-o-script-de-atualizacao-apontando-pro-arquivo-syncconf">Vai precisa configurar seu ip e o path pra rodar o script de atualiza√ß√£o, apontando pro arquivo sync.conf:</h2>
<div class="highlight"><pre><span></span><code>./upgrade-v1.0x-v1.2x.sh<span class="w"> </span>/etc/osync/sync.conf
</code></pre></div>
<h2 id="vai-ficar-semelhante-ao-modelo-abaixo_1">Vai ficar semelhante ao modelo abaixo:</h2>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">INSTANCE_ID</span><span class="o">=</span><span class="s2">&quot;sysvol_sync&quot;</span>

<span class="nv">INITIATOR_SYNC_DIR</span><span class="o">=</span><span class="s2">&quot;/opt/samba/var/locks/sysvol&quot;</span>

<span class="nv">TARGET_SYNC_DIR</span><span class="o">=</span><span class="s2">&quot;ssh://root@192.168.70.250:22250//opt/samba/var/locks/sysvol&quot;</span>

<span class="nv">SSH_RSA_PRIVATE_KEY</span><span class="o">=</span><span class="s2">&quot;/root/.ssh/id_rsa&quot;</span>

<span class="nv">SSH_PASSWORD_FILE</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">_REMOTE_TOKEN</span><span class="o">=</span><span class="s2">&quot;SomeAlphaNumericToken9&quot;</span>

<span class="nv">CREATE_DIRS</span><span class="o">=</span><span class="nb">false</span>

<span class="nv">LOGFILE</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">MINIMUM_SPACE</span><span class="o">=</span><span class="s2">&quot;10240&quot;</span>

<span class="nv">BANDWIDTH</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>

<span class="nv">SUDO_EXEC</span><span class="o">=</span><span class="nb">false</span>

<span class="nv">RSYNC_EXECUTABLE</span><span class="o">=</span><span class="s2">&quot;rsync&quot;</span>

<span class="nv">RSYNC_REMOTE_PATH</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">RSYNC_PATTERN_FIRST</span><span class="o">=</span><span class="s2">&quot;include&quot;</span>

<span class="nv">RSYNC_INCLUDE_PATTERN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">RSYNC_EXCLUDE_PATTERN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">RSYNC_INCLUDE_FROM</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">RSYNC_EXCLUDE_FROM</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="nv">PATH_SEPARATOR_CHAR</span><span class="o">=</span><span class="s2">&quot;;&quot;</span>

<span class="nv">SSH_COMPRESSION</span><span class="o">=</span><span class="nb">true</span>

<span class="nv">SSH_IGNORE_KNOWN_HOSTS</span><span class="o">=</span><span class="nb">false</span>

<span class="nv">SSH_CONTROLMASTER</span><span class="o">=</span><span class="nb">false</span>

<span class="nv">REMOTE_HOST_PING</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div>
<h2 id="testar-o-sincronizmo-ignore-o-erro-de-email">Testar o sincronizmo (ignore o erro de email):</h2>
<div class="highlight"><pre><span></span><code>/usr/local/bin/osync.sh<span class="w"> </span>/etc/osync/sync.conf<span class="w"> </span>--dry<span class="w"> </span>--verbose
</code></pre></div>
<h2 id="rodar-o-sincronizmo-de-fato_1">Rodar o sincronizmo de fato:</h2>
<div class="highlight"><pre><span></span><code>/usr/local/bin/osync.sh<span class="w"> </span>/etc/osync/sync.conf<span class="w"> </span>--verbose
</code></pre></div>
<h2 id="agendar-no-cron_1">Agendar no cron:</h2>
<div class="highlight"><pre><span></span><code>crontab<span class="w"> </span>-e
</code></pre></div>
<div class="highlight"><pre><span></span><code>*/5<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>root<span class="w">  </span>bash<span class="w"> </span>/usr/local/bin/osync.sh<span class="w"> </span>/etc/osync/sync.conf<span class="w"> </span>--silent
</code></pre></div>
<h2 id="validando-os-logs-em-tempo-real-rode-o-usrlocalbinosyncsh-mantendo-outro-terminal-aberto-com-o-comando_1">Validando os logs em tempo real, rode o /usr/local/bin/osync.sh, mantendo outro terminal aberto com o comando:</h2>
<div class="highlight"><pre><span></span><code>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/osync.sysvol_sync.log
</code></pre></div>
<p>THAT‚ÄôS ALL FOLKS!!</p>
<h1 id="fileserver-com-samba4-no-debian-linux-13">FileServer com Samba4 no Debian Linux 13</h1>
<h2 id="layout-de-rede-usado-no-laboratorio_2">Layout de rede usado no laborat√≥rio:</h2>
<div class="highlight"><pre><span></span><code>firewall<span class="w">           </span><span class="m">192</span>.168.70.254<span class="w"> </span><span class="o">(</span>enp1s0<span class="o">)</span><span class="w"> </span>-<span class="w"> </span><span class="m">192</span>.168.122.254<span class="w"> </span><span class="o">(</span>enp7s0<span class="o">)</span><span class="w"> </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">2277</span><span class="o">)</span>
dcmaster<span class="w">           </span><span class="m">192</span>.168.70.250<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22250</span><span class="o">)</span>
mkdocs<span class="w">             </span><span class="m">192</span>.168.70.222<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22222</span><span class="o">)</span>
dcslave<span class="w">            </span><span class="m">192</span>.168.70.200<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22200</span><span class="o">)</span>
fileserver<span class="w">         </span><span class="m">192</span>.168.70.150<span class="w">   </span><span class="o">(</span>ssh<span class="w"> </span><span class="m">22100</span><span class="o">)</span>

<span class="p">;</span><span class="w"> </span>firewall<span class="w">         </span>Roteamento<span class="w"> </span>por<span class="w"> </span>Iptables
<span class="p">;</span><span class="w"> </span>dcmaster<span class="w">         </span>Controlador<span class="w"> </span>de<span class="w"> </span>Dom√≠nio<span class="w"> </span>prim√°rio
<span class="p">;</span><span class="w"> </span>mkdocs<span class="w">           </span>Servidor<span class="w"> </span>de<span class="w"> </span>Documentos
<span class="p">;</span><span class="w"> </span>dcslave<span class="w">          </span>Controlador<span class="w"> </span>de<span class="w"> </span>Dom√≠nio<span class="w"> </span>secund√°rio
<span class="p">;</span><span class="w"> </span>fileserver<span class="w">       </span>Servidor<span class="w"> </span>de<span class="w"> </span>Arquivos
</code></pre></div>
<h2 id="instalando-as-dependencias-para-compilacao-do-codigo-fonte-do-samba4_2">Instalando as depend√™ncias para compila√ß√£o do c√≥digo fonte do Samba4:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive<span class="p">;</span>apt-get<span class="w"> </span>update<span class="p">;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>vim<span class="w"> </span>ntp<span class="w"> </span>net-tools<span class="w"> </span>rsync<span class="w"> </span>acl<span class="w"> </span>apt-utils<span class="w"> </span>attr<span class="w"> </span>autoconf<span class="w"> </span>bind9-utils<span class="w"> </span>binutils<span class="w"> </span>bison<span class="w"> </span>build-essential<span class="w"> </span>ntp<span class="w"> </span>rsync<span class="w"> </span>ccache<span class="w"> </span>chrpath<span class="w"> </span>curl<span class="w"> </span>debhelper<span class="w"> </span>bind9-dnsutils<span class="w"> </span>docbook-xml<span class="w"> </span>docbook-xsl<span class="w"> </span>flex<span class="w"> </span>gcc<span class="w"> </span>gdb<span class="w"> </span>git<span class="w"> </span>glusterfs-common<span class="w"> </span>gzip<span class="w"> </span>heimdal-multidev<span class="w"> </span>hostname<span class="w"> </span>htop<span class="w"> </span>krb5-config<span class="w"> </span>krb5-user<span class="w"> </span>lcov<span class="w"> </span>libacl1-dev<span class="w"> </span>libarchive-dev<span class="w"> </span>libattr1-dev<span class="w"> </span>libavahi-common-dev<span class="w"> </span>libblkid-dev<span class="w"> </span>libbsd-dev<span class="w"> </span>libcap-dev<span class="w"> </span>libcephfs-dev<span class="w"> </span>libcups2-dev<span class="w"> </span>libdbus-1-dev<span class="w"> </span>libglib2.0-dev<span class="w"> </span>libgnutls28-dev<span class="w"> </span>libgpgme-dev<span class="w"> </span>libicu-dev<span class="w"> </span>libjansson-dev<span class="w"> </span>libjs-jquery<span class="w"> </span>libjson-perl<span class="w"> </span>libkrb5-dev<span class="w"> </span>libldap2-dev<span class="w"> </span>liblmdb-dev<span class="w"> </span>libncurses-dev<span class="w"> </span>libpam0g-dev<span class="w"> </span>libparse-yapp-perl<span class="w"> </span>libpcap-dev<span class="w"> </span>libpopt-dev<span class="w"> </span>libreadline-dev<span class="w"> </span>libsystemd-dev<span class="w"> </span>libtasn1-bin<span class="w"> </span>libtasn1--5-dev<span class="w"> </span>libunwind-dev<span class="w"> </span>lmdb-utils<span class="w"> </span>locales<span class="w"> </span>lsb-release<span class="w"> </span>make<span class="w"> </span>mawk<span class="w"> </span>mingw-w64<span class="w"> </span>patch<span class="w"> </span>perl<span class="w"> </span>perl-modules-5.40<span class="w"> </span>pkg-config<span class="w"> </span>procps<span class="w"> </span>psmisc<span class="w"> </span>python3<span class="w"> </span>python3-cryptography<span class="w"> </span>python3-dbg<span class="w"> </span>python3-dev<span class="w"> </span>python3-dnspython<span class="w"> </span>python3-gpg<span class="w"> </span>python3-iso8601<span class="w"> </span>python3-markdown<span class="w"> </span>python3-matplotlib<span class="w"> </span>python3-pexpect<span class="w"> </span>python3-pyasn1<span class="w"> </span>rsync<span class="w"> </span>sed<span class="w">  </span>tar<span class="w"> </span>tree<span class="w"> </span>uuid-dev<span class="w"> </span>wget<span class="w"> </span>xfslibs-dev<span class="w"> </span>xsltproc<span class="w"> </span>zlib1g-dev<span class="w"> </span>-y
</code></pre></div>
<h2 id="setando-e-validando-o-hostname-do-dcslave_1">Setando e validando o hostname do dcslave:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/hostname
</code></pre></div>
<div class="highlight"><pre><span></span><code>fileserver
</code></pre></div>
<div class="highlight"><pre><span></span><code>hostname<span class="w"> </span>-f
</code></pre></div>
<div class="highlight"><pre><span></span><code>fileserver.officinas.edu
</code></pre></div>
<h2 id="configurando-o-arquivo-de-hosts_2">Configurando o arquivo de hosts:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/hosts
</code></pre></div>
<div class="highlight"><pre><span></span><code>.0.0.1<span class="w">              </span>localhost
<span class="m">127</span>.0.1.1<span class="w">           </span>fileserver.officinas.edu<span class="w">    </span>fileserver
<span class="m">192</span>.168.70.150<span class="w">      </span>fileserver.officinas.edu<span class="w">    </span>fileserver
<span class="m">192</span>.168.70.200<span class="w">      </span>dcslave.officinas.edu<span class="w">       </span>dcslave
<span class="m">192</span>.168.70.222<span class="w">      </span>mkdocs.officinas.edu<span class="w">        </span>mkdocs
<span class="m">192</span>.168.70.250<span class="w">      </span>dcmaster.officinas.edu<span class="w">      </span>dcmaster
<span class="m">192</span>.168.70.254<span class="w">      </span>firewall.officinas.edu<span class="w">      </span>firewall
</code></pre></div>
<h2 id="setando-ip-fixo-no-servidor-dcslave_1">Setando ip fixo no servidor dcslave:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/network/interfaces
</code></pre></div>
<div class="highlight"><pre><span></span><code>allow-hotplug<span class="w"> </span>enp1s0
iface<span class="w"> </span>enp1s0<span class="w"> </span>inet<span class="w"> </span>static
address<span class="w">           </span><span class="m">192</span>.168.70.150
netmask<span class="w">           </span><span class="m">255</span>.255.255.0
gateway<span class="w">           </span><span class="m">192</span>.168.70.254
</code></pre></div>
<h2 id="apontando-o-endereco-do-resolvedor-de-nomes-principal-da-rede-pro-controlador-de-dominio-primario-dcmaster-temporario">Apontando o endere√ßo do resolvedor de nomes principal da rede pro Controlador de dom√≠nio prim√°rio, dcmaster (tempor√°rio):</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>domain<span class="w">           </span>officinas.edu
search<span class="w">           </span>officinas.edu.
nameserver<span class="w">       </span><span class="m">192</span>.168.70.250<span class="w"> </span><span class="c1">#(dcmaster)</span>
nameserver<span class="w">       </span><span class="m">192</span>.168.70.200<span class="w"> </span><span class="c1">#(dcslave)</span>
</code></pre></div>
<h2 id="bloqueando-alteracao-do-resolvconf_1">Bloqueando altera√ß√£o do resolv.conf:</h2>
<div class="highlight"><pre><span></span><code>chattr<span class="w"> </span>+i<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<h2 id="validando-a-resolucao-de-nomes-pelo-dcmaster_1">Validando a resolu√ß√£o de nomes pelo dcmaster:</h2>
<div class="highlight"><pre><span></span><code>nslookup<span class="w"> </span>officinas.edu
</code></pre></div>
<div class="highlight"><pre><span></span><code>Server:<span class="w">         </span><span class="m">192</span>.168.70.250
Address:<span class="w">        </span><span class="m">192</span>.168.70.250#53

Name:<span class="w">   </span>officinas.edu
Address:<span class="w"> </span><span class="m">192</span>.168.70.250
Name:<span class="w">   </span>officinas.edu
Address:<span class="w"> </span><span class="m">192</span>.168.70.200
</code></pre></div>
<h2 id="relendo-as-configuracoes-de-rede_1">Relendo as configura√ß√µes de rede:</h2>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>networking
</code></pre></div>
<h2 id="validando-o-ip-da-placa_2">Validando o ip da placa:</h2>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>-c<span class="w"> </span>addr
</code></pre></div>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>-br<span class="w"> </span>link
</code></pre></div>
<h2 id="baixando-e-compilando-o-codigo-fonte-do-samba4_2">Baixando e compilando o c√≥digo fonte do Samba4:</h2>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://download.samba.org/pub/samba/samba-4.19.4.tar.gz
</code></pre></div>
<div class="highlight"><pre><span></span><code>tar<span class="w"> </span>-xvzf<span class="w"> </span>samba-4.19.4.tar.gz
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>samba-4.19.4
</code></pre></div>
<div class="highlight"><pre><span></span><code>./configure<span class="w"> </span>--prefix<span class="o">=</span>/opt/samba
</code></pre></div>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install
</code></pre></div>
<h2 id="adicionando-optsamba-ao-path-padrao-do-linux-colando-a-linha-completa-ao-final-do-bashrc_2">Adicionando /opt/Samba ao path padr√£o do Linux, colando a linha completa ao final do .bashrc:</h2>
<h2 id="pathusrlocalsbinusrlocalbinusrsbinusrbinsbinbinoptsambabinoptsambasbin_2">PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/samba/bin:/opt/samba/sbin"</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>~/.bashrc
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/samba/bin:/opt/samba/sbin&quot;</span>
</code></pre></div>
<h2 id="relendo-o-arquivo-de-profile_2">Relendo o arquivo de profile:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>~/.bashrc
</code></pre></div>
<h2 id="criando-o-daemon-de-inicializacao-do-samba4-com-o-sistema_2">Criando o daemon de inicializa√ß√£o do Samba4 com o sistema:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/systemd/system/samba-ad-dc.service
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>Unit<span class="o">]</span>
<span class="w">   </span><span class="nv">Description</span><span class="o">=</span>Samba4<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>Slave<span class="w"> </span>Domain<span class="w"> </span>Controller
<span class="w">   </span><span class="nv">After</span><span class="o">=</span>network.target<span class="w"> </span>remote-fs.target<span class="w"> </span>nss-lookup.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="w">   </span><span class="nv">Type</span><span class="o">=</span>forking
<span class="w">   </span><span class="nv">ExecStart</span><span class="o">=</span>/opt/samba/sbin/samba<span class="w"> </span>-D
<span class="w">   </span><span class="nv">PIDFile</span><span class="o">=</span>/opt/samba/var/run/samba.pid

<span class="o">[</span>Install<span class="o">]</span>
<span class="w">   </span><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>/etc/systemd/system/samba-ad-dc.service
</code></pre></div>
<h2 id="configurando-o-servico-de-sincronizacao-de-horario-apontando-pro-controlador-de-dominio-primario-dcmaster_1">Configurando o servi√ßo de sincroniza√ß√£o de hor√°rio, apontando pro Controlador de dom√≠nio prim√°rio, dcmaster:</h2>
<div class="highlight"><pre><span></span><code>mv<span class="w"> </span>/etc/ntpsec/ntp.conf<span class="o">{</span>,.orig<span class="o">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/ntpsec/ntp.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code>driftfile<span class="w"> </span>/var/lib/ntpsec/ntp.drift
leapfile<span class="w"> </span>/usr/share/zoneinfo/leap-seconds.list
tos<span class="w"> </span>minclock<span class="w"> </span><span class="m">4</span><span class="w"> </span>minsane<span class="w"> </span><span class="m">3</span>
pool<span class="w"> </span><span class="m">192</span>.168.70.250<span class="w"> </span>iburst<span class="w"> </span><span class="c1">#(dcmaster)</span>
restrict<span class="w"> </span>default<span class="w"> </span>kod<span class="w"> </span>nomodify<span class="w"> </span>nopeer<span class="w"> </span>noquery<span class="w"> </span>limited
restrict<span class="w"> </span><span class="m">127</span>.0.0.1
restrict<span class="w"> </span>::1
tinker<span class="w"> </span>panic<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1">#(Usado SOMENTE em VMs)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>ntp
</code></pre></div>
<div class="highlight"><pre><span></span><code>ntpq<span class="w"> </span>-p
</code></pre></div>
<div class="highlight"><pre><span></span><code>date
</code></pre></div>
<h2 id="atencao-nao-provisione-o-samba-do-fileserver">ATEN√á√ÉO!! N√ÉO PROVISIONE O SAMBA DO FILESERVER!!</h2>
<div class="admonition warning">
<p class="admonition-title">Aten√ß√£o</p>
<p>N√£o provisione o Fileserver.</p>
</div>
<h2 id="atencao-nao-provisione-o-samba-do-fileserver_1">ATEN√á√ÉO!! N√ÉO PROVISIONE O SAMBA DO FILESERVER!!</h2>
<h2 id="_1"></h2>
<h2 id="configurando-o-etckrb5conf">Configurando o /etc/krb5.conf:</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># vim /etc/krb5.conf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">[</span>libdefaults<span class="o">]</span><span class="w"> </span><span class="c1">#(sem espa√ßo no canto dessa linha)</span>
<span class="w">   </span><span class="nv">dns_lookup_realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="w">   </span><span class="nv">dns_lookup_kdc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="w">   </span><span class="nv">default_realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OFFICINAS.EDU
</code></pre></div>
<h2 id="configurando-o-time-server">Configurando o time server:</h2>
<div class="highlight"><pre><span></span><code>apt-get<span class="w"> </span>install<span class="w"> </span>ntp<span class="w"> </span>ntpdate<span class="w"> </span>-y
</code></pre></div>
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>/etc/ntpsec/ntp.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Rel√≥gio Local ( Nota: Este n√£o √© o endere√ßo localhost! )</span>
<span class="w">   </span>server<span class="w"> </span><span class="m">127</span>.127.1.0
<span class="w">   </span>fudge<span class="w">  </span><span class="m">127</span>.127.1.0<span class="w"> </span>stratum<span class="w"> </span><span class="m">10</span>
<span class="w">   </span>server<span class="w"> </span><span class="m">192</span>.168.70.250<span class="w"> </span>iburst<span class="w"> </span>prefer<span class="w"> </span><span class="c1">#(dcmaster)</span>
<span class="w">   </span>driftfile<span class="w"> </span>/var/lib/ntp/ntp.drift
<span class="w">   </span>logfile<span class="w">   </span>/var/log/ntp
<span class="w">   </span>restrict<span class="w"> </span>default<span class="w"> </span>ignore
<span class="w">   </span>restrict<span class="w"> </span><span class="m">127</span>.0.0.1
<span class="w">   </span>restrict<span class="w"> </span><span class="m">192</span>.168.70.250<span class="w">   </span>mask<span class="w"> </span><span class="m">255</span>.255.255.255<span class="w">    </span>nomodify<span class="w"> </span>notrap<span class="w"> </span>nopeer<span class="w"> </span>noquery
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>ntp
</code></pre></div>
<div class="highlight"><pre><span></span><code>ntpq<span class="w"> </span>-p
</code></pre></div>
<div class="highlight"><pre><span></span><code>date
</code></pre></div>
<h2 id="validando-mapeamentos">Validando mapeamentos:</h2>
<div class="highlight"><pre><span></span><code>getent<span class="w"> </span>hosts<span class="w"> </span>fileserver
</code></pre></div>
<h2 id="configurando-o-smbconf">Configurando o smb.conf:</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># vim /opt/samba/etc/smb.conf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Define as informa√ß√µes do dom√≠nio.</span>
<span class="w">   </span><span class="o">[</span>global<span class="o">]</span>
<span class="w">   </span><span class="nv">workgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OFFICINAS
<span class="w">   </span><span class="nv">realm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>officinas.edu

<span class="c1"># Define que esse servidor n√£o aceita acesso sem autentica√ß√£o.</span>
<span class="w">    </span><span class="nv">security</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ADS

<span class="c1"># Defique qual usu√°rio no dom√≠nio se equivale ao root.</span>
<span class="w">    </span>username<span class="w"> </span><span class="nv">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/opt/samba/etc/user.map

<span class="c1"># Par√¢metros para que as permiss√µes se comportem como o Windows.</span>
<span class="c1"># Herdando permiss√µes e guardando credenciais de logins bem-sucedidos.</span>
<span class="w">    </span>map<span class="w"> </span>acl<span class="w"> </span><span class="nv">inherit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes
<span class="w">    </span>store<span class="w"> </span>dos<span class="w"> </span><span class="nv">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes

<span class="c1"># Os VFS objects que ser√£o usados.</span>
<span class="w">    </span>vfs<span class="w"> </span><span class="nv">objects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>acl_xattr<span class="w"> </span>acl_tdb

<span class="c1"># Arquivo de configura√ß√£o do kerberos e qual m√©todo ser√° usado.</span>
<span class="w">    </span>dedicated<span class="w"> </span>keytab<span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/etc/krb5.keytab
<span class="w">    </span>kerberos<span class="w"> </span><span class="nv">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>secrets<span class="w"> </span>and<span class="w"> </span>keytab

<span class="c1"># Configura√ß√µes do backend para mapeamento de IDs para compatibilidade com Windows.</span>
<span class="w">    </span>idmap<span class="w"> </span>config<span class="w"> </span>*<span class="w"> </span>:<span class="w"> </span><span class="nv">backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tdb
<span class="w">    </span>idmap<span class="w"> </span>config<span class="w"> </span>*<span class="w"> </span>:<span class="w"> </span><span class="nv">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span>-7999
<span class="w">    </span>idmap<span class="w"> </span>config<span class="w"> </span>OFFICINAS:<span class="w"> </span><span class="nv">backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rid
<span class="w">    </span>idmap<span class="w"> </span>config<span class="w"> </span>OFFICINAS:<span class="w"> </span><span class="nv">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span>-999999

<span class="c1"># Define que o usu√°rio root n√£o precisa ser mapeado.</span>
<span class="w">    </span>min<span class="w"> </span>domain<span class="w"> </span><span class="nv">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>

<span class="c1"># Shell padr√£o e diret√≥rio home padr√£o.</span>
<span class="w">    </span>template<span class="w"> </span><span class="nv">shell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/bin/bash
<span class="w">    </span>template<span class="w"> </span><span class="nv">homedir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/home/%U

<span class="c1"># Define o comportamento do Winbind.</span>
<span class="w">    </span>winbind<span class="w"> </span>refresh<span class="w"> </span><span class="nv">tickets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes
<span class="w">    </span>winbind<span class="w"> </span>use<span class="w"> </span>default<span class="w"> </span><span class="nv">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes
<span class="w">    </span>winbind<span class="w"> </span>enum<span class="w"> </span><span class="nv">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes
<span class="w">    </span>winbind<span class="w"> </span>enum<span class="w"> </span><span class="nv">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes
<span class="w">    </span>winbind<span class="w"> </span>cache<span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7200</span>
<span class="w">    </span>winbind<span class="w"> </span>nss<span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rfc2307

<span class="c1"># Cada escrita  de dados ser√° seguida por um fsync() para garantir que os dados sejam gravados no disco. Usei em ext4 e xfs mas n√£o testei no btrfs.</span>
<span class="w">   </span>sync<span class="w"> </span><span class="nv">always</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes
<span class="w">   </span>strict<span class="w"> </span><span class="nv">sync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes

<span class="c1"># Onde ser√£o gravados os logs e o nivel de detalhes.</span>
<span class="w">   </span>log<span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/var/log/samba/%m.log
<span class="w">   </span>log<span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>

<span class="w">   </span><span class="o">[</span>FILESERVER<span class="o">]</span>
<span class="w">   </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/home/fileserver
<span class="w">   </span><span class="nv">comment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Compartilhamentos<span class="w"> </span>da<span class="w"> </span>Rede
<span class="w">   </span><span class="nb">read</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>No
<span class="w">   </span><span class="nv">browseable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes
<span class="w">   </span>vfs<span class="w"> </span><span class="nv">objects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>acl_xattr<span class="w"> </span>acl_tdb<span class="w"> </span>full_audit
<span class="w">   </span>full_audit:success<span class="w"> </span><span class="o">=</span><span class="w"> </span>renameat<span class="w"> </span>rewinddir<span class="w"> </span>unlinkat
<span class="w">   </span>full_audit:prefix<span class="w"> </span><span class="o">=</span><span class="w"> </span>%U<span class="p">|</span>%I<span class="p">|</span>%S
<span class="w">   </span>full_audit:failure<span class="w"> </span><span class="o">=</span><span class="w"> </span>none
<span class="w">   </span>full_audit:facility<span class="w"> </span><span class="o">=</span><span class="w"> </span>local4
<span class="w">   </span>full_audit:priority<span class="w"> </span><span class="o">=</span><span class="w"> </span>alert

<span class="c1"># PAR√ÇMETROS USADOS NA AUDITORIA:</span>
<span class="c1"># Adiciona todos os vfs objects.</span>
<span class="w">    </span>acl_xattr<span class="w"> </span>acl_tdb<span class="w"> </span>full_audit
<span class="c1"># arquivos renomeados, diret√≥rios renomeados, arquivos deletados.</span>
<span class="w">    </span>renameat<span class="w"> </span>rewinddir<span class="w"> </span>unlinkat
<span class="c1"># usu√°rio, ip, a√ß√£o.</span>
<span class="w">    </span>%U<span class="p">|</span>%I<span class="p">|</span>%S
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w"> </span>restart.samba
</code></pre></div>
<p>o Samba instalado em /opt/samba/ pode n√£o ter permiss√£o para gravar diretamente em /var/log/samba</p>
<div class="highlight"><pre><span></span><code>mkdir -p /var/log/samba
chown root:root /var/log/samba
chmod 755 /var/log/samba
</code></pre></div>
<p>Ou aponte para um diret√≥rio interno, como:</p>
<div class="highlight"><pre><span></span><code>log file = /opt/samba/var/logs/%m.log
</code></pre></div>
<h2 id="auditando-arquivos-deletados">Auditando arquivos deletados:</h2>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>/var/log/syslog<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>unlinkat
</code></pre></div>
<div class="highlight"><pre><span></span><code>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/syslog<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>unlinkat<span class="w"> </span><span class="c1">#(Teste em tempo real).</span>
</code></pre></div>
<h2 id="criando-o-diretorio-da-rede">Criando o diret√≥rio da rede:</h2>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>/home/fileserver
</code></pre></div>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">0770</span><span class="w"> </span>/home/fileserver
</code></pre></div>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:<span class="s2">&quot;domain admins&quot;</span><span class="w"> </span>/home/fileserver
</code></pre></div>
<div class="highlight"><pre><span></span><code>getfacl<span class="w"> </span>/home/fileserver
</code></pre></div>
<h2 id="extra-se-optar-por-uso-de-perfil-movel">EXTRA! SE optar por uso de perfil m√≥vel:</h2>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>/opt/samba/var/lib/samba/profiles
</code></pre></div>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">0770</span><span class="w"> </span>/opt/samba/var/lib/samba/profiles
</code></pre></div>
<div class="highlight"><pre><span></span><code>chown<span class="w"> </span>-R<span class="w"> </span>root:<span class="s2">&quot;domain admins&quot;</span><span class="w"> </span>/opt/samba/var/lib/samba/profiles
</code></pre></div>
<h2 id="adicionando-o-path-do-optsambaetcsmbconf">Adicionando o path do /opt/samba/etc/smb.conf:</h2>
<h2 id="linkando-as-bibliotecas-para-mapeamento-de-usuarios-de-sistema-local-e-samba4">Linkando as bibliotecas para mapeamento de usu√°rios de sistema local e Samba4:</h2>
<div class="highlight"><pre><span></span><code>/opt/samba/sbin/smbd<span class="w"> </span>-b<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>LIBDIR
</code></pre></div>
<div class="highlight"><pre><span></span><code>ln<span class="w"> </span>-s<span class="w"> </span>/opt/samba/lib/libnss_winbind.so.2<span class="w"> </span>/lib/x86-64-linux-gnu
</code></pre></div>
<div class="highlight"><pre><span></span><code>ln<span class="w"> </span>-s<span class="w"> </span>/lib/x86_64-linux-gnu/libnss_winbind.so.2<span class="w"> </span>/lib/x86_64-linux-gnu/libnss_winbind.so
</code></pre></div>
<div class="highlight"><pre><span></span><code>ldconfig
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/nsswitch.conf
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">   </span>passwd:<span class="w"> </span>files<span class="w"> </span>winbind
<span class="w">   </span>group:<span class="w"> </span>files<span class="w"> </span>winbind
<span class="w">   </span>shadow:<span class="w"> </span>files
</code></pre></div>
<h2 id="dando-poderes-de-root-ao-administrator_1">Dando poderes de root ao Administrator:</h2>
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>/opt/samba/etc/user.map
</code></pre></div>
<div class="highlight"><pre><span></span><code>!root<span class="o">=</span>officinas.edu<span class="se">\A</span>dministrator
</code></pre></div>
<h2 id="criando-o-diretorio-de-logs">Criando o diret√≥rio de logs:</h2>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>/var/log/samba
</code></pre></div>
<h2 id="validando-a-troca-de-tickets-do-kerberos_2">Validando a troca de tickets do Kerberos:</h2>
<div class="highlight"><pre><span></span><code>kinit<span class="w"> </span>Administrator
</code></pre></div>
<div class="highlight"><pre><span></span><code>klist
</code></pre></div>
<h2 id="ingressando-o-fileserver-ao-dominio">Ingressando o Fileserver ao dom√≠nio:</h2>
<div class="highlight"><pre><span></span><code>net<span class="w"> </span>ads<span class="w"> </span>join<span class="w"> </span>-U<span class="w"> </span>Administrator
</code></pre></div>
<h2 id="subindo-os-servicos-ao-boot-do-sistema">Subindo os servi√ßos ao boot do Sistema:</h2>
<div class="highlight"><pre><span></span><code>/opt/samba/sbin/smbd<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>/opt/samba/sbin/nmbd<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>/opt/samba/sbin/winbindd
</code></pre></div>
<h2 id="adicionando-o-smbd-ao-boot-do-linux">Adicionando o smbd ao boot do Linux:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/etc/systemd/system
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>smbd.service
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="o">[</span>Unit<span class="o">]</span>
<span class="w">   </span><span class="nv">Description</span><span class="o">=</span>Samba<span class="w"> </span>SMBD<span class="w"> </span>FileServer
<span class="w">   </span><span class="nv">After</span><span class="o">=</span>network.target<span class="w"> </span>remote-fs.target<span class="w"> </span>nss-lookup.target
<span class="w">   </span><span class="o">[</span>Service<span class="o">]</span>
<span class="w">   </span><span class="nv">Type</span><span class="o">=</span>forking
<span class="w">   </span><span class="nv">ExecStart</span><span class="o">=</span>/opt/samba/sbin/smbd
<span class="w">   </span><span class="nv">PIDFile</span><span class="o">=</span>/opt/samba/var/run/smbd.pid
<span class="w">   </span><span class="o">[</span>Install<span class="o">]</span>
<span class="w">   </span><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>
<h2 id="adicionando-o-nmbd-ao-boot-do-linux">Adicionando o nmbd ao boot do Linux:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/etc/systemd/system
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>nmbd.service
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="o">[</span>Unit<span class="o">]</span>
<span class="w">   </span><span class="nv">Description</span><span class="o">=</span>Samba<span class="w"> </span>NMBD<span class="w"> </span>FileServer
<span class="w">   </span><span class="nv">After</span><span class="o">=</span>network.target<span class="w"> </span>remote-fs.target<span class="w"> </span>nss-lookup.target
<span class="w">   </span><span class="o">[</span>Service<span class="o">]</span>
<span class="w">   </span><span class="nv">Type</span><span class="o">=</span>forking
<span class="w">   </span><span class="nv">ExecStart</span><span class="o">=</span>/opt/samba/sbin/nmbd
<span class="w">   </span><span class="nv">PIDFile</span><span class="o">=</span>/opt/samba/var/run/nmbd.pid
<span class="w">   </span><span class="o">[</span>Install<span class="o">]</span>
<span class="w">   </span><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>
<h2 id="adicionando-o-nmbd-ao-boot-do-linux_1">Adicionando o nmbd ao boot do Linux:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/etc/systemd/system
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>winbindd.service
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="o">[</span>Unit<span class="o">]</span>
<span class="w">   </span><span class="nv">Description</span><span class="o">=</span>Samba<span class="w"> </span>WINBIND<span class="w"> </span>FileServer
<span class="w">   </span><span class="nv">After</span><span class="o">=</span>network.target<span class="w"> </span>remote-fs.target<span class="w"> </span>nss-lookup.target
<span class="w">   </span><span class="o">[</span>Service<span class="o">]</span>
<span class="w">   </span><span class="nv">Type</span><span class="o">=</span>forking
<span class="w">   </span><span class="nv">ExecStart</span><span class="o">=</span>/opt/samba/sbin/winbindd
<span class="w">   </span><span class="nv">PIDFile</span><span class="o">=</span>/opt/samba/var/run/winbindd.pid
<span class="w">   </span><span class="o">[</span>Install<span class="o">]</span>
<span class="w">   </span><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>smbd.service<span class="w"> </span>nmbd.service<span class="w"> </span>winbindd.service
</code></pre></div>
<div class="highlight"><pre><span></span><code>pkill<span class="w"> </span>smb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pkill<span class="w"> </span>nmb<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pkill<span class="w"> </span>winbind
</code></pre></div>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>smbd.service<span class="w"> </span>nmbd.service<span class="w"> </span>winbindd.service
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;systemctl start smbd.service nmbd.service winbindd.service&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sbin/start.samba
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;systemctl stop smbd.service nmbd.service winbindd.service&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sbin/stop.samba
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;systemctl restart smbd.service nmbd.service winbindd.service&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sbin/restart.samba
</code></pre></div>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>/sbin/*.samba
</code></pre></div>
<h2 id="facilitando-o-boot-dos-servicos">Facilitando o boot dos servi√ßos:</h2>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;systemctl start smbd.service nmbd.service winbindd.service&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sbin/start.samba
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;systemctl stop smbd.service nmbd.service winbindd.service&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sbin/stop.samba
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;systemctl restart smbd.service nmbd.service winbindd.service&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sbin/restart.samba
</code></pre></div>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>/sbin/*.samba
</code></pre></div>
<h2 id="responde-agora-com">Responde agora com:</h2>
<div class="highlight"><pre><span></span><code>start.samba,<span class="w"> </span>restart.samba<span class="w"> </span>e<span class="w"> </span>stop.samba
</code></pre></div>
<h2 id="validando-wbinfo-e-getent">Validando wbinfo e getent:</h2>
<div class="highlight"><pre><span></span><code>wbinfo<span class="w"> </span>--ping-dc
</code></pre></div>
<div class="highlight"><pre><span></span><code>wbinfo<span class="w"> </span>-u
</code></pre></div>
<div class="highlight"><pre><span></span><code>wbinfo<span class="w"> </span>-g
</code></pre></div>
<div class="highlight"><pre><span></span><code>getent<span class="w"> </span>passwd<span class="w"> </span>Administrator
</code></pre></div>
<div class="highlight"><pre><span></span><code>getent<span class="w"> </span>group<span class="w"> </span><span class="s2">&quot;domain admins&quot;</span>
</code></pre></div>
<h2 id="criando-o-script-de-backup-do-homefileserver">Criando o script de backup do /home/fileserver:</h2>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>/media/HDEXTERNO
</code></pre></div>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/opt/samba/bkpdiario.sh
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="w">   </span><span class="nv">INICIO</span><span class="o">=</span><span class="sb">`</span>date<span class="w"> </span>+%d/%m/%Y-%H:%M:%S<span class="sb">`</span>
<span class="w">   </span><span class="nv">LOG</span><span class="o">=</span>/var/log/samba/bkpfileserver_<span class="sb">`</span>date<span class="w"> </span>+%Y-%m-%d<span class="sb">`</span>.txt
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$LOG</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$LOG</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;|-----------------------------------------------&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$LOG</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Sincronizacao iniciada em </span><span class="nv">$INICIO</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$LOG</span>
<span class="w">   </span>umount<span class="w"> </span>/media/HDEXTERNO
<span class="w">   </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/media/HDEXTERNO
<span class="w">   </span>rsync<span class="w"> </span>--delete<span class="w"> </span>-P<span class="w"> </span>-r<span class="w"> </span>-z<span class="w"> </span>-v<span class="w"> </span>/home/fileserver<span class="w"> </span>/media/HDEXTERNO/<span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$LOG</span>
<span class="w">   </span><span class="nv">FINAL</span><span class="o">=</span><span class="sb">`</span>date<span class="w"> </span>+%d/%m/%Y-%H:%M:%S<span class="sb">`</span>
<span class="w">   </span>umount<span class="w"> </span>/media/HDEXTERNO
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Sincronizacao Finalizada em </span><span class="nv">$FINAL</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$LOG</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;|-----------------------------------------------&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$LOG</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$LOG</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$LOG</span>
</code></pre></div>
<h2 id="adicionando-o-script-ao-crontab">Adicionando o script ao crontab:</h2>
<div class="highlight"><pre><span></span><code>vim<span class="w"> </span>/etc/crontab
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Rotinas de backup di√°rio do SAMBA4.</span>
<span class="c1"># Minuto/Hora/Dia/M√™s/Dia_semana/Usu√°rio/Comando</span>
<span class="w">   </span><span class="m">45</span><span class="w"> </span><span class="m">23</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span><span class="m">1</span>-5<span class="w"> </span>root<span class="w"> </span>/opt/samba/bkpdiario.sh<span class="w">  </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</code></pre></div>
<h2 id="vai-montar-o-hd-externo-fazer-o-backup-e-desmontar-o-hd-externo">VAI MONTAR O HD EXTERNO, FAZER O BACKUP E DESMONTAR O HD EXTERNO!</h2>
<p>THAT‚ÄôS ALL FOLKS!!</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">
  CC BY-SA 4.0
</a> - eduardo.charquero@gmail.com
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>